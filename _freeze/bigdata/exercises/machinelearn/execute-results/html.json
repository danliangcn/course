{
  "hash": "06e27bbb2d597d058a0d28c15ede432e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"机器学习作业\"\nauthor: \"\"\ndate: \"2025-12-08\"\nformat: \n  html:\n    toc-depth: 5\n---\n\n\n\n---\n\n## 机器学习课后作业说明\n\n### 作业目的\n\n* 加深对机器学习中回归、树模型与随机森林等算法的理解。\n* 掌握从真实公共管理相关数据出发，从数据准备、模型训练、模型评估、结果解释的完整流程。\n* 掌握选择模型和算法的能力，并理解模型优劣、过拟合、泛化、变量重要性等核心概念。\n* 为后续整体课程论文做好准备。\n\n### 作业要求与步骤\n\n1. **选数据**\n\n   * 依据上次作业整理好的数据集。\n   * 数据应包含多个特征变量（包括分类变量和尺度变量），以及一个清晰的目标变量，以便用于回归或分类任务。\n\n2. **数据预处理**\n\n   * 对数据进行必要清洗与预处理，包括处理缺失值、异常值，进行变量编码和转换，如标准化等。\n   * 拆分数据集为训练集与测试集，以便后续模型评估。\n\n3. **模型训练与比较**\n\n   * 根据数据与研究目标，分别训练以下模型（至少每个类别各选1个，至少三个）：\n\n     | 模型类别                  | 算法建议                        |\n     | --------------------- | --------------------------- |\n     | 回归   | 线性回归、正则化回归（如 Ridge/Lasso） |\n     | 树模型            | 决策树          |\n     | 集成模型                  | 随机森林         |\n\n   * 对于每个模型：训练模型、用测试集进行预测。\n\n   * 如果你选择分类任务（categorical target），计算评价指标如准确率 (accuracy)、混淆矩阵 (confusion matrix)、召回率 (recall)、精确率 (precision) 等。\n\n   * 如果是回归任务 (continuous target)，计算例如均方根误差(RMSE)、R² 等指标。\n\n4. **变量重要性与模型解释**\n\n   * 对于决策树 / 随机森林模型，提取、报告变量 (feature) 重要性 (feature importance)。\n   * 结合变量重要性与回归或分类系数，分析哪些变量对结果影响最大。\n   * 讨论为什么这些变量重要？是否符合公共管理或公共政策的逻辑，有什么政策含义？\n\n5. **结果报告**\n\n   * 制作至少 **3个图表** 例如：目标变量分布图 (histogram)，预测 vs 实际值散点图 (scatter + line)，特征变量重要性条形图 (bar chart)，决策树图 (tree plot)等。\n   * 结合图表报告结果，内容包括：\n     * 数据来源与简要描述 (变量、样本量、特征)\n     * 预处理步骤说明 (缺失值、异常值、编码等)\n     * 每个模型的训练过程与结果 (包括评价指标)\n     * 模型比较 (优劣、适合场景)\n     * 变量重要性与结果解释，对公共管理或公共政策的启示\n     * 局限性和后续可以改进的方向\n\n### 格式与提交\n\n* **提交形式**：R 脚本文件（.R 或 .Rmd）、清洗后的数据（CSV / RData）和结果报告（PDF）\n\n### 评分标准\n\n| 评分维度                   | 比例 |\n| ---------------------- | ------- |\n| 数据预处理合理性与清晰度           | 20%     |\n| 模型训练 + 结果 (至少三种模型) 完整性 | 25%     |\n| 模型比较与选择理由 + 变量重要性分析    | 20%     |\n| 可视化和结果解释 (公共管理和政策意义) | 20%     |\n| 报告结构、语言、引用规范、代码清晰度     | 15%     |\n\n---\n\n* **提交时间和方式**：两周之后，具体见数字化教学平台。\n\n\n\n\n---\n\n## 简要示例：**城市空气质量与影响因素分析**\n\n### **数据字段说明**\n\n| 变量名              | 含义                               | 类型  |\n| ---------------- | -------------------------------- | --- |\n| pm25             | 城市空气污染（PM2.5 浓度，目标变量）            | 连续型 |\n| temp             | 温度（℃）                            | 连续  |\n| humidity         | 湿度（%）                            | 连续  |\n| windspeed        | 风速（m/s）                          | 连续  |\n| rainfall         | 降雨量（mm）                          | 连续  |\n| industrial_index | 工业活动指数（反映排放强度）                   | 连续  |\n| pop_density      | 人口密度                             | 连续  |\n| green_rate       | 城市绿地率（%）                         | 连续  |\n| weekday          | 星期几（1–7）                         | 分类  |\n| region           | 城市区域类型（urban / suburban / rural） | 分类  |\n\n**机器学习任务：预测 PM2.5 浓度（回归）**\n\n适合：\n\n* 线性回归\n* 决策树回归\n* 随机森林回归\n* 模型比较\n* 特征重要性分析\n* 可视化分析\n\n---\n\n### R 代码模板\n\n以下模板包含：\n\n1. 数据加载\n2. 清洗与预处理\n3. 训练–测试集拆分\n4. 三类模型训练\n5. 模型比较\n6. 特征重要性\n7. 可视化\n\n```r\n# ================================\n# 0. 加载包\n# ================================\nlibrary(tidyverse)\nlibrary(caret)\nlibrary(rpart)\nlibrary(rpart.plot)\nlibrary(randomForest)\nlibrary(ggplot2)\n\n# ================================\n# 1. 导入数据\n# ================================\ndata <- read_csv(\"AirQuality_PM25.csv\")\n\nglimpse(data)\n\n# ================================\n# 2. 数据预处理\n# ================================\n\n# 将分类变量转换成 factor\ndata <- data %>%\n  mutate(\n    weekday = factor(weekday),\n    region = factor(region)\n  )\n\n# 检查缺失\ncolSums(is.na(data))\n\n# 简单缺失值处理（示例：用均值填补）\ndata$rainfall[is.na(data$rainfall)] <- mean(data$rainfall, na.rm = TRUE)\n\n# ================================\n# 3. 训练集与测试集拆分\n# ================================\nset.seed(123)\ntrain_index <- createDataPartition(data$pm25, p = 0.75, list = FALSE)\ntrain <- data[train_index, ]\ntest  <- data[-train_index, ]\n\n# ================================\n# 4. 模型训练\n# ================================\n\n# --- model 1: 线性回归 ---\nlm_model <- lm(pm25 ~ ., data = train)\nsummary(lm_model)\n\n# 预测\nlm_pred <- predict(lm_model, newdata = test)\n\n\n# --- model 2: 决策树 ---\ntree_model <- rpart(pm25 ~ ., data = train, method = \"anova\")\nrpart.plot(tree_model)\n\ntree_pred <- predict(tree_model, newdata = test)\n\n\n# --- model 3: 随机森林 ---\nrf_model <- randomForest(pm25 ~ ., data = train, ntree = 500, mtry = 4)\nprint(rf_model)\n\nrf_pred <- predict(rf_model, newdata = test)\n\n# ================================\n# 5. 模型评估\n# ================================\n# 定义一个 RMSE 函数\nrmse <- function(actual, predicted) {\n  sqrt(mean((actual - predicted)^2))\n}\n\ndata.frame(\n  Model = c(\"Linear Regression\", \"Decision Tree\", \"Random Forest\"),\n  RMSE = c(\n    rmse(test$pm25, lm_pred),\n    rmse(test$pm25, tree_pred),\n    rmse(test$pm25, rf_pred)\n  )\n)\n\n# ================================\n# 6. 随机森林：特征重要性\n# ================================\nimportance <- importance(rf_model)\nvarImpPlot(rf_model)\n\nprint(importance)\n\n# ================================\n# 7. 可视化示例\n# ================================\n\n# 真实 vs 预测（随机森林）\nplot_df <- data.frame(\n  actual = test$pm25,\n  predicted = rf_pred\n)\n\nggplot(plot_df, aes(x = actual, y = predicted)) +\n  geom_point(alpha = 0.6) +\n  geom_abline(color = \"red\", linetype = \"dashed\") +\n  labs(\n    title = \"真实值 vs 预测值（随机森林）\",\n    x = \"真实 PM2.5\",\n    y = \"预测 PM2.5\"\n  ) +\n  theme_minimal()\n\n```\n\n---\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}