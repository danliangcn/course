<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-12-09 四 11:33 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>一般统计方法的操作</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="厦门大学公共事务学院" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style>pre.src {background-color: #303030; color: #e5e5e5;}</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">一般统计方法的操作</h1>

<div id="outline-container-org5c91fea" class="outline-2">
<h2 id="org5c91fea"><span class="section-number-2">1</span> 概率分布</h2>
<div class="outline-text-2" id="text-1">
</div>

<div id="outline-container-org792a346" class="outline-3">
<h3 id="org792a346"><span class="section-number-3">1.1</span> 概率基础知识</h3>
<div class="outline-text-3" id="text-1-1">
<p>
概率：在随机试验中，某个结果所代表的事件发生的可能性。在实践中经常用频率来近似表示概率。
</p>

<p>
如果A, B代表可能的结果， \(P(\bar{A}) = 1 – P(A)\).  
如果A和B是截然不同的结果（不重叠），那么 \(P(A\cup B) = P(A) + P(B)\). 
</p>

<p>
存在条件概率： \(P(A \cap B) = P(A)P(B|A)\). 
如果A和B独立，则 \(P(B|A) = P(B)\) ，那么有 \(P(A \cap B) = P(A)P(B)\) .
</p>

<p>
<b>2008 美国GSS数据</b>
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">收入</th>
<th scope="col" class="org-right">很幸福</th>
<th scope="col" class="org-right">一般</th>
<th scope="col" class="org-right">不幸福</th>
<th scope="col" class="org-right">总计</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">高于平均</td>
<td class="org-right">164</td>
<td class="org-right">233</td>
<td class="org-right">26</td>
<td class="org-right">423</td>
</tr>

<tr>
<td class="org-left">平均</td>
<td class="org-right">293</td>
<td class="org-right">473</td>
<td class="org-right">117</td>
<td class="org-right">883</td>
</tr>

<tr>
<td class="org-left">低于平均</td>
<td class="org-right">132</td>
<td class="org-right">383</td>
<td class="org-right">172</td>
<td class="org-right">687</td>
</tr>

<tr>
<td class="org-left">总计</td>
<td class="org-right">589</td>
<td class="org-right">1089</td>
<td class="org-right">315</td>
<td class="org-right">1993</td>
</tr>
</tbody>
</table>
<p>
A = 高于平均收入，B = 很幸福  
</p>

<p>
P(A) = 423/1993 = 0.212 (边际概率)，P(not A) = 1 – P(A) = 0.788  
</p>

<p>
P(B) = 589/1993 = 0.296  
</p>

<p>
P(B|A) = 164/423 = 0.388 (条件概率)  
</p>

<p>
P(A &cap; B) = P(A)P(B | A) = 0.212(0.388) = 0.082 (等于 164/1993，联合概率)  
</p>

<p>
A和B独立吗？
</p>
</div>
</div>

<div id="outline-container-orgefb8d2f" class="outline-3">
<h3 id="orgefb8d2f"><span class="section-number-3">1.2</span> 频数表与列联表</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<ol class="org-ol">
<li><a id="org810077d"></a>频数表<br />
<div class="outline-text-4" id="text-1-2-1">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #4f97d7;">library</span>(vcd)

<span style="color: #4f97d7;">attach</span>(Arthritis)
table(Improved)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left">None</td>
<td class="org-right">42</td>
</tr>

<tr>
<td class="org-left">Some</td>
<td class="org-right">14</td>
</tr>

<tr>
<td class="org-left">Marked</td>
<td class="org-right">28</td>
</tr>
</tbody>
</table>
</div>
</li>

<li><a id="org207ee3c"></a>列联表<br />
<div class="outline-text-4" id="text-1-2-2">
<div class="org-src-container">
<pre class="src src-R">my <span style="color: #ce537a; font-weight: bold;">&lt;-</span> table(Treatment,Improved)
my
</pre>
</div>

<pre class="example">

         Improved
Treatment None Some Marked
  Placebo   29    7      7
  Treated   13    7     21

</pre>
</div>
</li>

<li><a id="org390361d"></a>转化为比例（概率、条件概率）<br />
<div class="outline-text-4" id="text-1-2-3">
<div class="org-src-container">
<pre class="src src-R">prop.table(my)
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#34892;&#26465;&#20214;&#27010;&#29575;</span>
prop.table(my,1)
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#21015;&#26465;&#20214;&#27010;&#29575;</span>
prop.table(my,2)
</pre>
</div>

<pre class="example">
         Improved
Treatment   None   Some Marked
  Placebo 0.3452 0.0833 0.0833
  Treated 0.1548 0.0833 0.2500

         Improved
Treatment  None  Some Marked
  Placebo 0.674 0.163  0.163
  Treated 0.317 0.171  0.512

         Improved
Treatment None Some Marked
  Placebo 0.69 0.50   0.25
  Treated 0.31 0.50   0.75
</pre>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgde8bb3c" class="outline-3">
<h3 id="orgde8bb3c"><span class="section-number-3">1.3</span> 频数表与列联表</h3>
<div class="outline-text-3" id="text-1-3">
</div>
<ol class="org-ol">
<li><a id="org9d604fc"></a>添加边际频数<br />
<div class="outline-text-4" id="text-1-3-1">
<div class="org-src-container">
<pre class="src src-R">addmargins(my)
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#28155;&#21152;&#34892;&#65288;&#21015;&#65289;&#36793;&#38469;&#39057;&#25968;</span>
addmargins(my,1)
addmargins(my,2)
</pre>
</div>

<pre class="example">
         Improved
Treatment None Some Marked Sum
  Placebo   29    7      7  43
  Treated   13    7     21  41
  Sum       42   14     28  84

         Improved
Treatment None Some Marked
  Placebo   29    7      7
  Treated   13    7     21
  Sum       42   14     28

         Improved
Treatment None Some Marked Sum
  Placebo   29    7      7  43
  Treated   13    7     21  41
</pre>
</div>
</li>

<li><a id="org71296f2"></a>添加边际概率<br />
<div class="outline-text-4" id="text-1-3-2">
<div class="org-src-container">
<pre class="src src-R">addmargins(prop.table(my))
</pre>
</div>

<pre class="example">
         Improved
Treatment   None   Some Marked    Sum
  Placebo 0.3452 0.0833 0.0833 0.5119
  Treated 0.1548 0.0833 0.2500 0.4881
  Sum     0.5000 0.1667 0.3333 1.0000

</pre>
</div>
</li>

<li><a id="org5ec77f6"></a>列联表的另一种方法<br />
<div class="outline-text-4" id="text-1-3-3">
<div class="org-src-container">
<pre class="src src-R">xtabs(~Treatment+Improved)
</pre>
</div>

<pre class="example">
         Improved
Treatment None Some Marked
  Placebo   29    7      7
  Treated   13    7     21

</pre>
</div>
</li>
</ol>
</div>

<div id="outline-container-org63e8524" class="outline-3">
<h3 id="org63e8524"><span class="section-number-3">1.4</span> 变量的概率分布</h3>
<div class="outline-text-3" id="text-1-4">
<p>
概率分布指随机变量可能的结果（或结果区间）及其概率
</p>
</div>

<ol class="org-ol">
<li><a id="orgd85c1ec"></a>离散型变量<br />
<div class="outline-text-4" id="text-1-4-1">
<p>
P(y) 表示变量 y 的可能结果和概率
\[0\leq P(y) \leq 1, \sum P(y)=1\]
</p>
</div>
</li>

<li><a id="org2e8fc3e"></a>连续型变量<br />
<div class="outline-text-4" id="text-1-4-2">
<p>
连续型变量的概率分布是取值区间的分配概率。
正态分布：
</p>
<ul class="org-ul">
<li>对称，钟形</li>
<li>以均值 &mu; 和标准差 &sigma; 为中心趋势和分散程度特征</li>
<li>对于所有的正态分布，在 &mu; 的任一个特定数值的标准差内的概率是相同的。（68-95-99.7法则）</li>
</ul>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #4f97d7;">par</span>(mar=c(4,4,0.1,0.1))
curve(dnorm,-4,4,yaxs=<span style="color: #2d9574;">'i'</span>)
polygon(c(1,seq(1,4,0.1),4),c(0,dnorm(seq(1,4,0.1)),0),col = <span style="color: #2d9574;">"red"</span>)
</pre>
</div>


<div class="figure">
<p><img src="1.png" alt="1.png" />
</p>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org3e88328" class="outline-3">
<h3 id="org3e88328"><span class="section-number-3">1.5</span> 正态曲线尾部概率表</h3>
<div class="outline-text-3" id="text-1-5">
<p>
尾部概率：大于 \(\mu + z\sigma\) 的值出现的概率，或距离均值超过z个标准差的值出现的概率  
</p>

<p>
z的第二个小数点位
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">z</th>
<th scope="col" class="org-right">.00</th>
<th scope="col" class="org-right">.01</th>
<th scope="col" class="org-right">.02</th>
<th scope="col" class="org-right">.03</th>
<th scope="col" class="org-right">.04</th>
<th scope="col" class="org-right">.05</th>
<th scope="col" class="org-right">.06</th>
<th scope="col" class="org-right">.07</th>
<th scope="col" class="org-right">.08</th>
<th scope="col" class="org-right">.09</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0.0</td>
<td class="org-right">.5000</td>
<td class="org-right">.4960</td>
<td class="org-right">.4920</td>
<td class="org-right">.4880</td>
<td class="org-right">.4840</td>
<td class="org-right">.4801</td>
<td class="org-right">.4761</td>
<td class="org-right">.4721</td>
<td class="org-right">.4681</td>
<td class="org-right">.4641</td>
</tr>

<tr>
<td class="org-right">&#x2026;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-right">1.4</td>
<td class="org-right">.0808</td>
<td class="org-right">.0793</td>
<td class="org-right">.0778</td>
<td class="org-right">.0764</td>
<td class="org-right">.0749</td>
<td class="org-right">.0735</td>
<td class="org-right">.0722</td>
<td class="org-right">.0708</td>
<td class="org-right">.0694</td>
<td class="org-right">.0681</td>
</tr>

<tr>
<td class="org-right">1.5</td>
<td class="org-right">.0668</td>
<td class="org-right">.0655</td>
<td class="org-right">.0643</td>
<td class="org-right">.0630</td>
<td class="org-right">.0618</td>
<td class="org-right">.0606</td>
<td class="org-right">.0594</td>
<td class="org-right">.0582</td>
<td class="org-right">.0571</td>
<td class="org-right">.0559</td>
</tr>
</tbody>
</table>

<p>
问题： 落在区间 µ - 1.50σ 到  µ + 1.50σ 的概率是多少？ 0.072右尾概率对应的z值是多少？  
<b><b>从概率到z值，从z值到概率的变换，要理解清晰，熟练掌握。</b></b>
</p>
</div>
</div>

<div id="outline-container-orgb57cc1a" class="outline-3">
<h3 id="orgb57cc1a"><span class="section-number-3">1.6</span> z分数（z-scores）和标准正态分布</h3>
<div class="outline-text-3" id="text-1-6">
<ul class="org-ul">
<li>变量值y的z分数是y离开均值的标准差数: \(z = (观测值-均值)/ 标准差 = (y - \mu )/\sigma\)</li>
</ul>
<p>
例子:    y = 65, µ = 50, σ = 10 \(z = (y - \mu)/\sigma = (65 – 50)/10 = 1.5\)  
</p>

<ul class="org-ul">
<li>标准正态分布是均值 µ = 0, 标准差 σ = 1的正态分布</li>

<li>z分数和标准正态分布：如果一个变量服从一个正态分布，并且其值通过减去均值和除以标准差被转换为z分数，则z分数服从标准正态分布。</li>
</ul>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #4f97d7;">options</span>(digits = 3)
pnorm(65, mean=50, sd=10, lower.tail = <span style="color: #a45bad;">FALSE</span>)
pnorm(c(-1.5,1.5))
qnorm(0.072)*(-1)
</pre>
</div>

<pre class="example">

[1] 0.0668

[1] 0.0668 0.9332

[1] 1.46

</pre>
</div>
</div>

<div id="outline-container-org08a2bbb" class="outline-3">
<h3 id="org08a2bbb"><span class="section-number-3">1.7</span> 抽样分布</h3>
<div class="outline-text-3" id="text-1-7">
<p>
抽样分布：抽样分布展现一个统计量（平均值、标准差等）的可以取的值，以及这些值的概率。
</p>

<p>
例子：y = 1 如果同意房地产限购政策；y = 0 如果反对
</p>

<p>
假设样本容量n = 3（注意：抽样次数的区别），考虑样本均值  
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">样本</th>
<th scope="col" class="org-left">均值</th>
<th scope="col" class="org-left">样本</th>
<th scope="col" class="org-left">均值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">(1, 1, 1)</td>
<td class="org-left">1.0</td>
<td class="org-left">(1, 0, 0)</td>
<td class="org-left">1/3</td>
</tr>

<tr>
<td class="org-left">(1, 1, 0)</td>
<td class="org-left">2/3</td>
<td class="org-left">(0, 1, 0)</td>
<td class="org-left">1/3</td>
</tr>

<tr>
<td class="org-left">(1, 0, 1)</td>
<td class="org-left">2/3</td>
<td class="org-left">(0, 0, 1)</td>
<td class="org-left">1/3</td>
</tr>

<tr>
<td class="org-left">(0, 1, 1)</td>
<td class="org-left">2/3</td>
<td class="org-left">(0, 0, 0)</td>
<td class="org-left">0</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org18a687a" class="outline-3">
<h3 id="org18a687a"><span class="section-number-3">1.8</span> 样本均值的抽样分布</h3>
<div class="outline-text-3" id="text-1-8">
<ul class="org-ul">
<li>样本均值 \(\bar y\) 的值随样本的改变而改变，是围绕总体均值 &mu; 波动的变量。</li>
<li>\(\bar y\)的抽样分布的标准差被称为 \(\bar y\)的标准误（standard error）。</li>
<li>假定从均值 &mu; 和标准差 &sigma; 的一个总体中抽取容量为n的一个随机样本。 \(\bar y\) 的抽样分布给出 \(\bar y\)的可能值的概率。它的均值为 &mu; ，标准误为:</li>
</ul>
<p>
\(\sigma_{\bar y}=\frac{\sigma}{\sqrt n}=\frac{总体标准差}{\sqrt{样本容量}}\)   
</p>
<ul class="org-ul">
<li>实践的意义：在实际研究中，关于相同主题的研究，由于不同的样本，也可能导致研究结果的不同。</li>
</ul>
</div>
</div>
<div id="outline-container-org3d6b583" class="outline-3">
<h3 id="org3d6b583"><span class="section-number-3">1.9</span> 中心极限定理</h3>
<div class="outline-text-3" id="text-1-9">
<p>
中心极限定理：对于大样本量n的随机抽样，样本均值 \(\bar y\) 的抽样分布是一个近似的正态分布  。
</p>

<ul class="org-ul">
<li>抽样分布的近似正态适用于总体分布的任何形态。</li>
<li>在抽样分布是钟形分布之前n必须有多大，这很大程度上取决于总体分布的偏斜程度。</li>
<li>通过重复选取随机样本，对每个n个观测值的样本计算 \(\bar y\)，可以从经验上验证中心极限定理。</li>
<li>中心极限定理意味着：当一个变量是许多个别因素产生的平均结果（没有主导因素）的时候，那么这个变量的分布是接近正态的（例如智商、血压）。</li>
<li>实践中，我们并不知道总体均值 &mu; ，但是我们能够采用抽样分布的离散情况来作为推断未知参数的基础。</li>
</ul>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #4f97d7;">par</span>(mar=c(3,4,0.1,0.1),mfrow=c(4,4))
set.seed(1234)
n <span style="color: #ce537a; font-weight: bold;">&lt;-</span> c(2,10,30)
curve(dunif,-0.1,1.1,yaxs=<span style="color: #2d9574;">'i'</span>,ylim=c(0,1.5),xlab = <span style="color: #2d9574;">""</span>,ylab = <span style="color: #2d9574;">"uniform"</span>)
samplemean <span style="color: #ce537a; font-weight: bold;">&lt;-</span> <span style="color: #a45bad;">NULL</span>
<span style="color: #4f97d7; font-weight: bold;">for</span>(k <span style="color: #4f97d7; font-weight: bold;">in</span> n){
  <span style="color: #4f97d7; font-weight: bold;">for</span> (i <span style="color: #4f97d7; font-weight: bold;">in</span> 1:10000){
    samplemean[i] <span style="color: #ce537a; font-weight: bold;">&lt;-</span> mean(runif(k))
  }  
plot(density(samplemean),main = <span style="color: #2d9574;">""</span>,xlab = <span style="color: #2d9574;">""</span>,ylab = <span style="color: #2d9574;">""</span>)
}
plot(c(0,1,2),dbinom(c(0,1,2),2,0.3),type=<span style="color: #2d9574;">"h"</span>,yaxs=<span style="color: #2d9574;">'i'</span>,xlab = <span style="color: #2d9574;">""</span>,ylab = <span style="color: #2d9574;">"binomial"</span>,xlim=c(-0.5,2.5),ylim = c(0,0.6))
samplemean <span style="color: #ce537a; font-weight: bold;">&lt;-</span> <span style="color: #a45bad;">NULL</span>
<span style="color: #4f97d7; font-weight: bold;">for</span>(k <span style="color: #4f97d7; font-weight: bold;">in</span> n){
  <span style="color: #4f97d7; font-weight: bold;">for</span> (i <span style="color: #4f97d7; font-weight: bold;">in</span> 1:10000){
    samplemean[i] <span style="color: #ce537a; font-weight: bold;">&lt;-</span> mean(rbinom(k,2,0.3))
  }  
  plot(density(samplemean),main = <span style="color: #2d9574;">""</span>,xlab = <span style="color: #2d9574;">""</span>,ylab = <span style="color: #2d9574;">""</span>)
}
curve(dlnorm,0,10,yaxs=<span style="color: #2d9574;">'i'</span>,xlab = <span style="color: #2d9574;">""</span>,ylab = <span style="color: #2d9574;">"lognorm"</span>)
samplemean <span style="color: #ce537a; font-weight: bold;">&lt;-</span> <span style="color: #a45bad;">NULL</span>
<span style="color: #4f97d7; font-weight: bold;">for</span>(k <span style="color: #4f97d7; font-weight: bold;">in</span> n){
  <span style="color: #4f97d7; font-weight: bold;">for</span> (i <span style="color: #4f97d7; font-weight: bold;">in</span> 1:10000){
    samplemean[i] <span style="color: #ce537a; font-weight: bold;">&lt;-</span> mean(rlnorm(k))
  }  
  plot(density(samplemean),main = <span style="color: #2d9574;">""</span>,xlab = <span style="color: #2d9574;">""</span>,ylab = <span style="color: #2d9574;">""</span>)
}
curve(dnorm,-4,4,yaxs=<span style="color: #2d9574;">'i'</span>,xlab = <span style="color: #2d9574;">""</span>,ylab = <span style="color: #2d9574;">"normal"</span>)
samplemean <span style="color: #ce537a; font-weight: bold;">&lt;-</span> <span style="color: #a45bad;">NULL</span>
<span style="color: #4f97d7; font-weight: bold;">for</span>(k <span style="color: #4f97d7; font-weight: bold;">in</span> n){
  <span style="color: #4f97d7; font-weight: bold;">for</span> (i <span style="color: #4f97d7; font-weight: bold;">in</span> 1:10000){
    samplemean[i] <span style="color: #ce537a; font-weight: bold;">&lt;-</span> mean(rnorm(k))
  }  
  plot(density(samplemean),main = <span style="color: #2d9574;">""</span>,xlab = <span style="color: #2d9574;">""</span>,ylab = <span style="color: #2d9574;">""</span>)
}
</pre>
</div>


<div class="figure">
<p><img src="2.png" alt="2.png" />
</p>
</div>

<p>
由左到右为：总体分布、抽样分布（2）、抽样分布（10）、抽样分布（30）
</p>
</div>
</div>
</div>


<div id="outline-container-org0ac3003" class="outline-2">
<h2 id="org0ac3003"><span class="section-number-2">2</span> 统计推断：估计</h2>
<div class="outline-text-2" id="text-2">
</div>

<div id="outline-container-orgf221367" class="outline-3">
<h3 id="orgf221367"><span class="section-number-3">2.1</span> 参数估计</h3>
<div class="outline-text-3" id="text-2-1">
<ul class="org-ul">
<li>目标：如何利用样本数据估计总体参数的值</li>
<li>点估计：是对参数进行最佳推测的一个数值。</li>
<li>区间估计：是以点估计为中心的一个数值区间，参数值被认为落在其中。</li>
</ul>
</div>
</div>

<div id="outline-container-org860965f" class="outline-3">
<h3 id="org860965f"><span class="section-number-3">2.2</span> 点估计</h3>
<div class="outline-text-3" id="text-2-2">
<ul class="org-ul">
<li>利用样本均值估计总体均值 &mu;</li>
</ul>
<p>
\[\hat \mu=\bar y=\frac{\sum y_i}{n}\]
</p>

<ul class="org-ul">
<li>利用样本标准差估计总体标准差 &sigma;</li>
</ul>
<p>
\[\hat \sigma=s=\sqrt{\frac{\sum (y_i-\bar y)^2}{n-1}}\]
</p>
<ul class="org-ul">
<li>利用样本比例 \(\hat \pi\) 估计总体比例 &pi;</li>
</ul>
</div>
</div>

<div id="outline-container-org55c8506" class="outline-3">
<h3 id="org55c8506"><span class="section-number-3">2.3</span> 好估计量具有的性质</h3>
<div class="outline-text-3" id="text-2-3">
<ul class="org-ul">
<li><b>无偏的：</b> 估计量的抽样分布以参数为中心</li>
</ul>
<p>
e.g. 有偏的估计量：样本全距
</p>
<ul class="org-ul">
<li><b>有效的：</b> 与其他估计量相比，具有尽可能小的标准误</li>
</ul>
<p>
e.g. 如果总体分布是对称的，并且接近正态，样本均值比样本中位值在估计总体均值和中位值时，更有效
</p>
</div>
</div>

<div id="outline-container-orge00df17" class="outline-3">
<h3 id="orge00df17"><span class="section-number-3">2.4</span> 置信区间（Confidence Intervals）</h3>
<div class="outline-text-3" id="text-2-4">
<ul class="org-ul">
<li>参数的置信区间是一个相信参数落在其中的数值区间。</li>
<li>这种方法产生一个包含参数的区间概率称为置信水平。大多数研究采用的接近1的置信水平，例如0.95或者0.99.</li>

<li>置信区间的形式：</li>
</ul>
<p>
\[点估计 \pm 误差边际\]
</p>

<ul class="org-ul">
<li>误差边际是由点估计的抽样分布的离散程度决定的。</li>
</ul>

<p>
e.g. 构造拥有“95%置信度”的一个置信区间，可用点估计加减约两个标准差的误差边际。
</p>
</div>
</div>

<div id="outline-container-org9325375" class="outline-3">
<h3 id="org9325375"><span class="section-number-3">2.5</span> 比例的置信区间</h3>
<div class="outline-text-3" id="text-2-5">
<ul class="org-ul">
<li>当 \(y = 1\) 代表感兴趣类别的一个观测值时， \(y = 0\) 就代表另外的观测值，样本比例 \(\hat \pi\) 是一个均值。</li>

<li>总体比例 \(\pi\) 是下面分布的均值</li>
</ul>
<p>
\[P(1)=\pi \\ P(0)=1-\pi\]
</p>

<ul class="org-ul">
<li>这个概率分布的标准差是：</li>
</ul>
<p>
\[\sigma =\sqrt{\pi (1-\pi )}\]
</p>

<ul class="org-ul">
<li>样本比例 \(\hat \pi\)的标准误是：</li>
</ul>
<p>
\[\sigma_{\hat \pi}=\sigma / \sqrt{n}=\sqrt{\pi (1-\pi ) / n}\]
</p>
</div>
</div>

<div id="outline-container-orgdd90c0c" class="outline-3">
<h3 id="orgdd90c0c"><span class="section-number-3">2.6</span> 比例的置信区间</h3>
<div class="outline-text-3" id="text-2-6">
<ul class="org-ul">
<li>对于大的随机样本，样本比例的抽样分布是接近正态的（中心极限定理）</li>

<li>那么，样本比例 \(\hat \pi\) 应以0.95的概率落在其均值（总体比 \(\pi\)）的两个标准差（准确值是1.96）之内。</li>
</ul>
<p>
\[\hat \pi \quad 落在 \quad \pi - 1.96\sigma_{\hat \pi} \quad 和 \quad \pi + 1.96\sigma_{\hat \pi} \quad 之间\]
</p>

<ul class="org-ul">
<li>一旦选取了样本，那么有95%的信心，</li>
</ul>
<p>
\[\hat \pi - 1.96\sigma_{\hat \pi} \quad 到 \quad \hat \pi + 1.96\sigma_{\hat \pi} \quad 之间包含 \quad \pi\]
此即总体比例的置信区间。
</p>

<ul class="org-ul">
<li>由于样本比例的标准误含有未知参数，用估计值代替</li>
</ul>

<p>
\[se=\sqrt{\hat \pi (1- \hat \pi )} \qquad 替代 \qquad  \sigma_{\hat \pi}=\sqrt{\pi (1-\pi ) / n}\]
</p>


<ul class="org-ul">
<li>对 &pi; 的95%的置信区间为：</li>
</ul>
<p>
\[\hat \pi - 1.96(se) \qquad 到 \qquad \hat \pi + 1.96(se)\]
</p>
</div>
</div>

<div id="outline-container-orgede5086" class="outline-3">
<h3 id="orgede5086"><span class="section-number-3">2.7</span> 置信区间的性质</h3>
<div class="outline-text-3" id="text-2-7">
<ul class="org-ul">
<li>置信区间的宽度随置信水平的增大而增大；随样本量的增大而变小。</li>

<li>置信区间是长期正确的比例.</li>

<li>区间估计方法产生不包括参数的置信区间的概率被称为错误概率 \(\alpha\)</li>

<li>\(\alpha = 1- 置信水平\)</li>
</ul>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">\(1-\alpha\)</th>
<th scope="col" class="org-right">\(\alpha\)</th>
<th scope="col" class="org-right">\(\alpha /2\)</th>
<th scope="col" class="org-right">\(Z_{\alpha /2}\)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">90%</td>
<td class="org-right">.10</td>
<td class="org-right">.050</td>
<td class="org-right">1.645</td>
</tr>

<tr>
<td class="org-right">95%</td>
<td class="org-right">.05</td>
<td class="org-right">.025</td>
<td class="org-right">1.96</td>
</tr>

<tr>
<td class="org-right">99%</td>
<td class="org-right">.01</td>
<td class="org-right">.005</td>
<td class="org-right">2.58</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org085134d" class="outline-3">
<h3 id="org085134d"><span class="section-number-3">2.8</span> 均值的置信区间</h3>
<div class="outline-text-3" id="text-2-8">
<ul class="org-ul">
<li>对于大的随机样本，样本均值有渐进正态的抽样分布，其均值为&mu;，标准误 \(\sigma_{\bar y}=\sigma / \sqrt n\)</li>

<li>相似的，有 \(P(\mu-1.96\sigma_{\bar y} \leq \bar{y} \leq \mu+1.96\sigma_{\bar y})=0.95\)</li>

<li>有95%的置信度，样本均值落在（未知）总体均值的1.96个标准误的范围内。</li>

<li>标准误是未知的，因此要用样本数据的点估计来代替标准误</li>
</ul>

<p>
\[\bar y \pm 1.96(se), \quad 即 \quad \bar y \pm 1.96\frac{s}{\sqrt n} \qquad se=\frac{s}{\sqrt n}\]
</p>

<ul class="org-ul">
<li>对于较大的样本容量是没有问题的，但是对于较小的样本量，用估计量s替代 &sigma; 会造成误差，置信区间会偏小。因此要采用t分数代替z分数。</li>
</ul>
</div>
</div>

<div id="outline-container-orgaf10581" class="outline-3">
<h3 id="orgaf10581"><span class="section-number-3">2.9</span> t 分布  (Student’s t from W.S. Gosset)</h3>
<div class="outline-text-3" id="text-2-9">
<ul class="org-ul">
<li>t分布是钟形分布并关于均值0对称。</li>

<li>标准差略大于1（比标准正态分布的尾部要厚一些）</li>
</ul>
<p>
具体形状由自由度(df)决定。对于总体均值的推断，自由度为 df = n – 1 
</p>

<ul class="org-ul">
<li>随着自由度df的增加，t分布越接近于标准正态分布，df大于30时，几乎与标准正态分布相同。</li>

<li>t分数（代替z分数）乘以估计的标准误，给出了均值的置信区间的误差边际。</li>
</ul>

<div class="figure">
<p><img src="./image1.png" alt="image1.png" width="150" />
</p>
</div>
</div>
</div>
<div id="outline-container-orgb230266" class="outline-3">
<h3 id="orgb230266"><span class="section-number-3">2.10</span> 部分 t 分数</h3>
<div class="outline-text-3" id="text-2-10">
<p>
<b>置信水平</b>  
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">&#xa0;</th>
<th scope="col" class="org-right">90%</th>
<th scope="col" class="org-right">95%</th>
<th scope="col" class="org-right">98%</th>
<th scope="col" class="org-right">99%</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">df</td>
<td class="org-right">t.050</td>
<td class="org-right">t.025</td>
<td class="org-right">t.010</td>
<td class="org-right">t.005</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">6.314</td>
<td class="org-right">12.706</td>
<td class="org-right">31.821</td>
<td class="org-right">63.657</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">1.812</td>
<td class="org-right">2.228</td>
<td class="org-right">2.764</td>
<td class="org-right">3.169</td>
</tr>

<tr>
<td class="org-right">16</td>
<td class="org-right">1.746</td>
<td class="org-right">2.120</td>
<td class="org-right">2.583</td>
<td class="org-right">2.921</td>
</tr>

<tr>
<td class="org-right">30</td>
<td class="org-right">1.697</td>
<td class="org-right">2.042</td>
<td class="org-right">2.457</td>
<td class="org-right">2.750</td>
</tr>

<tr>
<td class="org-right">100</td>
<td class="org-right">1.660</td>
<td class="org-right">1.984</td>
<td class="org-right">2.364</td>
<td class="org-right">2.626</td>
</tr>

<tr>
<td class="org-right">无穷大</td>
<td class="org-right">1.645</td>
<td class="org-right">1.960</td>
<td class="org-right">2.326</td>
<td class="org-right">2.576</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>df = 无穷大时，和标准正态分布相同。</li>
</ul>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #4f97d7;">options</span>(digits=4)
qt(0.025, df=10, lower.tail=<span style="color: #a45bad;">FALSE</span>)
</pre>
</div>

<pre class="example">

[1] 2.228

</pre>
</div>
</div>

<div id="outline-container-org5285712" class="outline-3">
<h3 id="org5285712"><span class="section-number-3">2.11</span> 总体均值的置信区间</h3>
<div class="outline-text-3" id="text-2-11">
<ul class="org-ul">
<li>对于来自正态总体分布的随机样本，均值 &mu; 的95%置信区间为：</li>
</ul>

<p>
\[\bar y \pm t_.025 \times se, \quad 其中 \quad se=s/\sqrt n\]
</p>

<p>
计算t分数的自由度df = n - 1
</p>

<ul class="org-ul">
<li>正态分布的假定是确保对于任何的n抽样分布都是钟形。</li>

<li><b>总体均值 &mu; 置信区间的性质</b>  
<ul class="org-ul">
<li>对均值的置信区间的假定是：使用随机化选择样本；总体分布是正态的。在这两个假定下，样本均值的抽样分布是正态的。用估计的标准误替代未知的真实标准误后，样本均值服从t分布。</li>

<li>在违背正态总体假定时，对均值使用t分布的置信区间是稳健的（robust）。但是，如果样本数据非常偏态或包含极端异常值，方法的稳健性会降低，因此要进行探索性分析。</li>

<li>置信水平越高，那么置信区间就越大；样本容量 n 越大，置信区间越窄。</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org1da2856" class="outline-3">
<h3 id="org1da2856"><span class="section-number-3">2.12</span> 用R计算置信区间</h3>
<div class="outline-text-3" id="text-2-12">
<ul class="org-ul">
<li>比例的置信区间：1000人的样本中700人选择“YES”，总体比例的95%的置信区间</li>
</ul>
<div class="org-src-container">
<pre class="src src-R">y <span style="color: #ce537a; font-weight: bold;">&lt;-</span> 700
n <span style="color: #ce537a; font-weight: bold;">&lt;-</span> 1000
estimate <span style="color: #ce537a; font-weight: bold;">&lt;-</span> y/n
se <span style="color: #ce537a; font-weight: bold;">&lt;-</span> sqrt (estimate*(1-estimate)/n)
int.95 <span style="color: #ce537a; font-weight: bold;">&lt;-</span> estimate + qnorm(c(.025,.975))*se
int.95

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#33258;&#21160;&#35745;&#31639;&#65292;&#40664;&#35748;&#26159;95%&#30340;&#32622;&#20449;&#21306;&#38388;</span>
cinterval <span style="color: #ce537a; font-weight: bold;">&lt;-</span> prop.test(y,n)
cinterval$conf.int
</pre>
</div>

<pre class="example">

[1] 0.6716 0.7284

[1] 0.6704 0.7281
attr(,"conf.level")
[1] 0.95

</pre>

<ul class="org-ul">
<li>均值的置信区间：5个人的年龄组成的样本，总体平均年龄的95%的置信区间</li>
</ul>
<div class="org-src-container">
<pre class="src src-R">y <span style="color: #ce537a; font-weight: bold;">&lt;-</span> c(35,34,38,35,37)
n <span style="color: #ce537a; font-weight: bold;">&lt;-</span> length(y)
estimate <span style="color: #ce537a; font-weight: bold;">&lt;-</span> mean(y)
se <span style="color: #ce537a; font-weight: bold;">&lt;-</span> sd(y)/sqrt(n)
int.95 <span style="color: #ce537a; font-weight: bold;">&lt;-</span> estimate + qt(c(.025,.975),n-1)*se
int.95
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#33258;&#21160;&#35745;&#31639;&#65292;&#40664;&#35748;&#26159;95%&#30340;&#32622;&#20449;&#21306;&#38388;</span>
cinterval <span style="color: #ce537a; font-weight: bold;">&lt;-</span> t.test(y)
cinterval$conf.int
</pre>
</div>

<pre class="example">

[1] 33.76 37.84

[1] 33.76 37.84
attr(,"conf.level")
[1] 0.95

</pre>
</div>
</div>

<div id="outline-container-org66eed91" class="outline-3">
<h3 id="org66eed91"><span class="section-number-3">2.13</span> 置信区间的含义</h3>
<div class="outline-text-3" id="text-2-13">
<ul class="org-ul">
<li>置信区间是长期正确的比例：95% 的置信度为有95%的区间会覆盖总体均值 \(\mu\)</li>
</ul>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Set the random seed</span>
set.seed(123456)

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">initialize vectors to later store results:</span>
CIlower <span style="color: #ce537a; font-weight: bold;">&lt;-</span> numeric(10000); CIupper <span style="color: #ce537a; font-weight: bold;">&lt;-</span> numeric(10000)
pvalue1 <span style="color: #ce537a; font-weight: bold;">&lt;-</span> numeric(10000); pvalue2 <span style="color: #ce537a; font-weight: bold;">&lt;-</span> numeric(10000)

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">repeat 10000 times:</span>
<span style="color: #4f97d7; font-weight: bold;">for</span>(j <span style="color: #4f97d7; font-weight: bold;">in</span> 1:10000) {
  <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Draw a sample</span>
  sample <span style="color: #ce537a; font-weight: bold;">&lt;-</span> rnorm(100,10,2)
  <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">test the (correct) null hypothesis mu=10:</span>
  testres1 <span style="color: #ce537a; font-weight: bold;">&lt;-</span> t.test(sample,mu=10)
  <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">store CI &amp; p value:</span>
  CIlower[j] <span style="color: #ce537a; font-weight: bold;">&lt;-</span> testres1$conf.int[1]
  CIupper[j] <span style="color: #ce537a; font-weight: bold;">&lt;-</span> testres1$conf.int[2]
  pvalue1[j] <span style="color: #ce537a; font-weight: bold;">&lt;-</span> testres1$p.value
}

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Test results as logical value</span>
reject1<span style="color: #ce537a; font-weight: bold;">&lt;-</span>pvalue1&lt;=0.05

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">color vector:</span>
color <span style="color: #ce537a; font-weight: bold;">&lt;-</span> rep(gray(.5),100)
color[reject1[1:100]] <span style="color: #ce537a; font-weight: bold;">&lt;-</span> <span style="color: #2d9574;">"black"</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Prepare empty plot with correct axis limits &amp; labels:</span>
plot(0, xlim=c(9,11), ylim=c(1,100), 
                       ylab=<span style="color: #2d9574;">"Sample No."</span>, xlab=<span style="color: #2d9574;">""</span>, main=<span style="color: #2d9574;">"Correct H0"</span>)
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Vertical line at 10:</span>
abline(v=10, lty=2)
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Add the 100 first CIs (y is equal to j for both points):</span>
<span style="color: #4f97d7; font-weight: bold;">for</span>(j <span style="color: #4f97d7; font-weight: bold;">in</span> 1:100) {
  lines(c(CIlower[j],CIupper[j]),c(j,j),col=color[j],lwd=2)
}
</pre>
</div>


<div class="figure">
<p><img src="3.png" alt="3.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org8b6a9ca" class="outline-3">
<h3 id="org8b6a9ca"><span class="section-number-3">2.14</span> 样本量的选择</h3>
<div class="outline-text-3" id="text-2-14">
<ul class="org-ul">
<li>在估计总体比例时，选取多大的样本量，才能使得置信度为0.95，误差不超过0.03？

<ul class="org-ul">
<li>可以让 0.03 = 误差边际，然后求 n 的值</li>

<li>\(0.03=1.96\sigma_{\hat \pi}=1.96\sqrt{\pi (1-\pi) / n}\)</li>

<li>\(n=\pi (1-\pi)(1.96/0.03)^2=4268\pi (1-\pi)\)</li>

<li>&pi;=0.5 时，n值最大，所以 \(n=4268\cdot 0.5\cdot 0.5=1067\)</li>
</ul></li>
<li>如果从前的研究显示总体均值大概是0.20，95%置信区间的误差边际为0.03的最低样本量为：</li>
</ul>

<p>
\[n=\pi (1-\pi)(1.96/0.03)^2=4268\pi (1-\pi) \\ =4268\cdot 0.2 \cdot 0.8=83\]
</p>

<ul class="org-ul">
<li>总体比例接近0或1的时候，要比总体比例接近0.5更“容易”估计</li>

<li>除非完全不了解总体比例的值，最好是用估计值，而不是0.50计算</li>
</ul>
</div>
</div>

<div id="outline-container-orgaa99ab3" class="outline-3">
<h3 id="orgaa99ab3"><span class="section-number-3">2.15</span> 样本量的选择</h3>
<div class="outline-text-3" id="text-2-15">
<ul class="org-ul">
<li>确定估计的参数的类别（总体比例或者总体均值）</li>

<li>选择误差边际 (M) 和置信水平 (决定z分数)</li>

<li>比例（如果不知道，可设 \(\pi=0.50\)）：</li>
</ul>

<p>
\[n=\pi (1-\pi)(\frac{z}{M})^2\]
</p>

<ul class="org-ul">
<li>均值（需推测总体标准差的值 \(\sigma\)）：</li>
</ul>

<p>
\[n=\sigma^2(\frac{z}{M})^2\]
</p>

<ul class="org-ul">
<li>置信区间与样本量：

<ul class="org-ul">
<li>样本量与置信水平（更高的置信度要求更大的样本量）和总体变异度（变异程度越高要求更大的样本量）相关。</li>

<li>实践中，事先确定样本容量比较难。一是因为许多参数都要估计；二是因为资源有限，需要权衡。</li>

<li>任何参数都可以确定其置信区间。</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgdc46da0" class="outline-3">
<h3 id="orgdc46da0"><span class="section-number-3">2.16</span> 实际使用置信区间时需要考虑的因素</h3>
<div class="outline-text-3" id="text-2-16">
<ul class="org-ul">
<li>确定感兴趣的变量类型：
<ul class="org-ul">
<li>定量变量 – 推断均值</li>
<li>类别变量 – 推断比例</li>
</ul></li>

<li>检验前提条件是否满足？
<ul class="org-ul">
<li>随机化 (抽样分布及其标准误)</li>

<li><p>
其他条件？
</p>

<p>
均值：数据探索性分析检查数据的分布确保均值是一个合适的参数。
</p>

<p>
比例：类别中的观察个体至少有15个，不在类别中的观察个体也至少15个。
</p></li>
</ul></li>
</ul>
</div>
</div>
</div>


<div id="outline-container-org27453b9" class="outline-2">
<h2 id="org27453b9"><span class="section-number-2">3</span> 统计推断：显著性检验</h2>
<div class="outline-text-2" id="text-3">
</div>

<div id="outline-container-org3ca33d5" class="outline-3">
<h3 id="org3ca33d5"><span class="section-number-3">3.1</span> 显著性检验</h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li>目的：利用统计方法检验假设

<ul class="org-ul">
<li>“治疗厌食症，采用认知行为家庭疗法与安慰剂产生的平均体重变化相同”  （没有效果）</li>

<li>“社会经济地位越高则心理健康程度越高”  （存在效应）</li>

<li>“为别人花钱比为自己花钱更幸福”</li>
</ul></li>

<li>假设：在统计推断中，对研究所关心的变量，我们会对总体的参数进行某种预测，这种对总体参数的预测便是一个假设。</li>

<li>显著性检验利用样本对参数的点估计与假设预测的参数值之间比较，来评价一个假设。</li>

<li>一般而言我们回答这样一个问题：“如果假设成立，得到现有样本数据的 <b>不可能性</b> 有多高？”</li>
</ul>
</div>
</div>

<div id="outline-container-org35a9761" class="outline-3">
<h3 id="org35a9761"><span class="section-number-3">3.2</span> 显著性检验的5个部分</h3>
<div class="outline-text-3" id="text-3-2">
<ol class="org-ol">
<li>前提假定（Assumptions）：数据类型（定量数据、分类数据）、抽样方式（随机化）、总体分布（正态分布等）、样本量（是否足够大）</li>

<li>假设（Hypotheses）:   
<ul class="org-ul">
<li>原假设（ \(H_0\)）：对参数取一个特定值的陈述。(一般是指“没有效果”)</li>
<li>备择假设（ \(H_a\)）：陈述参数值落在某个备择的值域。（一般指“有效果”）</li>
</ul></li>

<li>检验统计量：用来和原假设的预测进行比较。一般通过标准误的个数来测量样本点估计与原假设的参数值之间的距离。</li>

<li>P值 (P): 用概率来表现的关于原假设成立与否的证据。在原假设成立的条件下，检验统计量等于观测值及更极端值的概率（备择假设预测的方向）。P值越小，那么反对原假设的证据越强。</li>

<li>结论：   
<ul class="org-ul">
<li>无需判断的话，只报告p值和进行解释。</li>
<li>如需判断的话，选择一个临界点（显著性水平，例如0.05或者0.01）。如果P值小于等于这个临界点的值，那么就拒绝原假设。</li>
</ul></li>
</ol>
</div>
</div>

<div id="outline-container-org2ec6856" class="outline-3">
<h3 id="org2ec6856"><span class="section-number-3">3.3</span> 均值的显著性检验</h3>
<div class="outline-text-3" id="text-3-3">
<ul class="org-ul">
<li>前提假定：随机化，定量变量，正态总体分布（稳健性）</li>

<li>原假设： H<sub>0</sub>: &mu;=&mu;<sub>0</sub>，其中 &mu;<sub>0是总体均值的一个特定的值</sub>。
(通常与某个标准相比没有效果或没有变化)</li>

<li>备择假设： \(H_{\alpha}: \mu \neq \mu_0\) 
双侧备择包括大于和小于原假设值</li>

<li>检验统计量： 样本均值离原假设值的距离，用标准误的个数来衡量。</li>
</ul>
<p>
\[t=\frac{\bar y-\mu_0}{se}, \quad se=s/\sqrt n\]
当原假设 H<sub>0</sub> 为真，t统计量的抽样分布是自由度为 df = n – 1 的t分布。
</p>

<ul class="org-ul">
<li>P值：原假设为真的假定下，t统计量等于观察值或更极端的取值的概率。
对于双侧备择假设 H<sub>&alpha;</sub>，那么对应是双尾概率</li>

<li>结论：报告和解释P值，如有需要，还要对原假设H<sub>0</sub>进行判断。</li>
</ul>
</div>
</div>

<div id="outline-container-org9e0e0ac" class="outline-3">
<h3 id="org9e0e0ac"><span class="section-number-3">3.4</span> 例子：厌食症的治疗</h3>
<div class="outline-text-3" id="text-3-4">
<ul class="org-ul">
<li>y为治疗后与治疗前的体重差值：11.4, 11.0, 5.5, 9.4, 13.6, -2.9, -0.1, 7.4, 21.5, -5.3, -3.8, 13.4, 13.1, 9.0, 3.9, 5.7, 10.7</li>
</ul>

<p>
<b>如何证明治疗有效果？</b>  
</p>
<ul class="org-ul">
<li>设 &mu; 为体重变化的总体均值</li>
<li>检验原假设  \(H_0: \mu=0\)（无效果），相应备择假设 \(H_{\alpha}: \mu \neq 0\).</li>
<li>由数据可以得到</li>
</ul>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">变量</th>
<th scope="col" class="org-right">样本量</th>
<th scope="col" class="org-right">均值</th>
<th scope="col" class="org-right">标准差</th>
<th scope="col" class="org-right">均值标准误</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">体重差</td>
<td class="org-right">17</td>
<td class="org-right">7.265</td>
<td class="org-right">7.157</td>
<td class="org-right">1.736</td>
</tr>
</tbody>
</table>

<p>
\[se=s/\sqrt n=7.157/\sqrt {17}=1.736\]
</p>

<ul class="org-ul">
<li>检验统计量（df=16）： \(t=\frac{\bar y - \mu_0}{se}=\frac{7.265-0}{1.736}=4.18\)</li>

<li>P值： \(pvalue=2 \times P(t>4.18)=0.0007\)（软件计算）说明如果原假设 H<sub>0</sub> 为真，那么得到一个距离原假设0值至少4.18个标准误远的样本均值的概率为 0.0007。</li>

<li>结论：非常强的证据显示总体均值不为0. （具体看起来 \(\mu >0\)）</li>
</ul>
</div>
</div>

<div id="outline-container-org61685b6" class="outline-3">
<h3 id="org61685b6"><span class="section-number-3">3.5</span> 单样本均值的显著性检验</h3>
<div class="outline-text-3" id="text-3-5">
<div class="org-src-container">
<pre class="src src-R">y <span style="color: #ce537a; font-weight: bold;">&lt;-</span> c(11.4, 11.0, 5.5, 9.4, 13.6, -2.9, -0.1, 7.4, 21.5, -5.3, -3.8, 13.4, 13.1, 9.0, 3.9, 5.7, 10.7)
n <span style="color: #ce537a; font-weight: bold;">&lt;-</span>length(y)
se <span style="color: #ce537a; font-weight: bold;">&lt;-</span> sd(y)/sqrt(n)
t <span style="color: #ce537a; font-weight: bold;">&lt;-</span> (mean(y)-0)/(se)
pvalue <span style="color: #ce537a; font-weight: bold;">&lt;-</span> 2*(1-pt(t,df=16))

t.test(y)
</pre>
</div>

<pre class="example">

	One Sample t-test

data:  y
t = 4.1849, df = 16, p-value = 0.0007003
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
  3.58470 10.94471
sample estimates:
mean of x 
 7.264706 

</pre>
</div>
</div>

<div id="outline-container-orge65e0e2" class="outline-3">
<h3 id="orge65e0e2"><span class="section-number-3">3.6</span> 双侧检验与置信区间之间的对应关系</h3>
<div class="outline-text-3" id="text-3-6">
<ul class="org-ul">
<li>当双侧检验的 P值 &le; 0.05时，总体均值 &mu; 的95%的置信区间不包括原假设 H<sub>0</sub> 预测的均值 (例如为0)</li>

<li>上面的例子：P = 0.0007, 95% 的置信区间为  (3.6, 10.9)</li>

<li>当双侧检验的 P值 &gt; 0.05 时，95% 的置信区间必然包括原假设 H<sub>0</sub> 预测的均值。</li>

<li>置信区间提供了更多关于总体均值的信息</li>
</ul>

<p>
例子: 假设样本均值为7.265、标准差为 7.16都保持不变，但是样本容量 n = 4    (不是前面的 n = 17)，那么双侧检验的p值为0.14，95%的置信区间为(-4.1, 18.7)，即p值大于显著性水平，相应置信区间包含了0.
</p>
</div>
</div>
<div id="outline-container-org4ec179f" class="outline-3">
<h3 id="org4ec179f"><span class="section-number-3">3.7</span> 均值的单侧检验</h3>
<div class="outline-text-3" id="text-3-7">
<p>
例子：
如果研究预测到治疗方法有正面效果，可以采用备择假设 H<sub>&alpha;</sub>&gt;0，如果t在右尾部越远，则表明数据越支持这个备择假设，那么此时的P值 = 右尾概率。
</p>
<ul class="org-ul">
<li>假定对于样本 n = 4 (df = 3)，有 t = 2.0，那么 \(Pvalue = P(t > 2.0) = 0.07\)</li>
<li>如果备择假设是： \(H_{\alpha}: \mu <0\),  P值 = 左尾概率； \(Pvalue = P(t < 2.0) = 0.93\)</li>
<li>实践中，双侧检验更普遍。</li>
</ul>
</div>
</div>

<div id="outline-container-orgf0a2124" class="outline-3">
<h3 id="orgf0a2124"><span class="section-number-3">3.8</span> 统计决策</h3>
<div class="outline-text-3" id="text-3-8">
<p>
&alpha; 水平是一个选定的数值，被称为显著性水平。 
</p>

<p>
如果P值 &le; &alpha; ，那么拒绝原假设 \(H_0\)
如果P值 &gt; &alpha; ，那么不拒绝原假设 \(H_0\) 
</p>

<p>
注意：表述是“不拒绝 \(H_0\)” 而不是“接受 \(H_0\)”，因为原假设 \(H_0\)  的值仅仅是众多可能取值中的一个。
</p>

<p>
例子 (n = 4, 双侧): 假定 \(\alpha=0.05\). 由于 P值 =  0.14，那么我们不能拒绝原假设 \(H_0\).  但是 0 仅仅是95%置信区间 (-4.1, 18.7)的取值中的一个，所以我们只能是不拒绝，不能表述为接受。
</p>
</div>
</div>

<div id="outline-container-org76626cf" class="outline-3">
<h3 id="org76626cf"><span class="section-number-3">3.9</span> 样本量大小对检验的影响</h3>
<div class="outline-text-3" id="text-3-9">
<ul class="org-ul">
<li>当样本量 n 比较大时（例如，n &gt; 30），根据中心极限定理，正态总体分布假定变得不重要。</li>

<li>对于小样本量而言，如果正态总体假定不成立，双侧 t 检验是稳健的，然而单侧检验不稳健。</li>

<li>对于给定的观察样本均值和标准差，样本量越大，检验统计量越大（因为分母中的标准误se越小），p值越小</li>

<li>当样本量越大的时候，越可能拒绝一个错误的原假设 \(H_0\)</li>

<li>当样本量较大时，“统计显著性”不等于是“具有实际意义的显著性”</li>
</ul>
</div>
</div>

<div id="outline-container-org01ccf55" class="outline-3">
<h3 id="org01ccf55"><span class="section-number-3">3.10</span> 比例的显著性检验</h3>
<div class="outline-text-3" id="text-3-10">
<ul class="org-ul">
<li>前提假定：类别变量、随机化、大样本（但是小样本做双侧检验也OK）</li>

<li>假设：
<ul class="org-ul">
<li>原假设: \(H_0: \pi=\pi_0\)</li>
<li>备择假设: \(H_{\alpha}: \pi \neq \pi_0\)(双侧)； H<sub>&alpha;</sub>: &pi; &gt; &pi;<sub>0</sub> 或者 \(H_{\alpha}: \pi < \pi_0\)(单侧)</li>
<li>在得到数据前就要设定好假设</li>
</ul></li>

<li>检验统计量</li>
</ul>

<p>
\[z=\frac{\hat \pi-\pi_0}{\sigma_{\hat \pi}}=\frac{\hat \pi-\pi_0}{\sqrt{\pi_0(1-\pi_0)/n}}\]
</p>
<ul class="org-ul">
<li>p值：
<ul class="org-ul">
<li>\(H_{\alpha}: \pi \neq \pi_0\) P=标准正态分布双尾概率</li>
<li>\(H_{\alpha}: \pi > \pi_0\) P=标准正态分布的右尾概率</li>
<li>\(H_{\alpha}: \pi < \pi_0\) P=标准正态分布的左尾概率</li>
</ul></li>

<li>结论：如果P值小于等于显著性水平，则拒绝原假设 \(H_0\)</li>
</ul>
</div>
</div>

<div id="outline-container-org0d098bb" class="outline-3">
<h3 id="org0d098bb"><span class="section-number-3">3.11</span> 例子：狗能闻出膀胱癌吗？(British Medical Journal, 2004)</h3>
<div class="outline-text-3" id="text-3-11">
<p>
每次测试，1个膀胱癌尿样放在6个控制尿样中，如何检验狗能否比随机猜测得到更好的结果？
</p>

<p>
让 \(\pi=\) 某次测试猜对的概率。 \(H_0: \ \pi-1/7\) (= 0.143, 没有影响),  \(H_{\alpha}>1/7\)
</p>

<p>
54次测试，狗能够做出正确的选择22次。样本比例 = 22/54 = 0.407
</p>

<p>
标准差 \(se_0=\sqrt{\pi_0(1-\pi_0)/n}=\sqrt{(1/7)(6/7)/54}=0.0476\)
</p>

<p>
检验统计量： \(z=(\hat \pi-\pi_0)/se_0=(0.407-(1/7))/0.0476=5.6\)
</p>

<p>
p值=标准正态分布的右尾概率=0.00000001
</p>

<p>
因此，有非常强的证据显示狗的选择比随机猜测要更好。
</p>

<p>
那么对于标准的显著性水平 &alpha; 为0.05，我们拒绝原假设 H<sub>0</sub> 得到结论 \(\pi>1/7\).
</p>
</div>
</div>

<div id="outline-container-org68c7adc" class="outline-3">
<h3 id="org68c7adc"><span class="section-number-3">3.12</span> 检验中的决策</h3>
<div class="outline-text-3" id="text-3-12">
<ul class="org-ul">
<li>&alpha; 水平（显著性水平）：是一个事先指定的“门槛”，如果P值落在它（一般采用0.05或者0.01）之下，那么拒绝原假设 \(H_0\)</li>

<li>拒绝域：检验拒绝 H<sub>0</sub> 的那些检验统计量值的集合。对于显著性水平 &alpha;=0.05 的双侧检验，如果 |z|&ge; 1.96 ，那么拒绝 \(H_0\)</li>

<li>错误类型
<ul class="org-ul">
<li>第一类型错误：当原假设 H<sub>0</sub> 为真时，拒绝原假设</li>

<li>第二类型错误：当原假设 H<sub>0</sub> 为假时，不拒绝原假设</li>

<li>&alpha; 是第一类错误的概率，选择的 &alpha; 越小，则第二类错误发生的概率 &beta; 会增加</li>

<li>检验的功效 = 1-&beta; = P(原假设为假的条件下拒绝它)</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgc9c14b4" class="outline-3">
<h3 id="orgc9c14b4"><span class="section-number-3">3.13</span> 正态总体单样本参数假设检验</h3>
<div class="outline-text-3" id="text-3-13">
<ul class="org-ul">
<li>总体均值的检验（大样本： \(n \ge 30\)）</li>
</ul>

<p>
&sigma;<sup>2</sup> 已知：
\[ z=\frac{\bar x-\mu_0}{\sigma/\sqrt{n}}\sim N(0,1)\]
</p>

<p>
&sigma;<sup>2</sup>未知：
\[ z=\frac{\bar x-\mu_0}{s/\sqrt{n}}\sim N(0,1)\]
</p>
<ul class="org-ul">
<li>总体均值的检验（正态总体小样本）</li>
</ul>

<p>
&sigma;<sup>2</sup>已知：
\[ z=\frac{\bar x-\mu_0}{\sigma/\sqrt{n}}\sim N(0,1)\]
</p>

<p>
&sigma;<sup>2</sup>未知：
\[ t=\frac{\bar x-\mu_0}{s/\sqrt{n}}\sim t(n-1)\]
</p>
</div>
</div>

<div id="outline-container-org53ee2c5" class="outline-3">
<h3 id="org53ee2c5"><span class="section-number-3">3.14</span> 例子</h3>
<div class="outline-text-3" id="text-3-14">
<p>
某汽车生产商声称其生产的汽车每加仑汽油可行驶的里程不低于25英里，标准差为2.4英里。消协组织了一个由10位汽车主组成的小组，他们的汽车每加仑汽油的可行驶英里数如下表。假定汽车每加仑可行驶里程服从正态分布。现在问，汽车生产商的诺言可信吗？
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">序号</th>
<th scope="col" class="org-right">1</th>
<th scope="col" class="org-right">2</th>
<th scope="col" class="org-right">3</th>
<th scope="col" class="org-right">4</th>
<th scope="col" class="org-right">5</th>
<th scope="col" class="org-right">6</th>
<th scope="col" class="org-right">7</th>
<th scope="col" class="org-right">8</th>
<th scope="col" class="org-right">9</th>
<th scope="col" class="org-right">10</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">里程</td>
<td class="org-right">22</td>
<td class="org-right">24</td>
<td class="org-right">21</td>
<td class="org-right">24</td>
<td class="org-right">23</td>
<td class="org-right">24</td>
<td class="org-right">23</td>
<td class="org-right">22</td>
<td class="org-right">21</td>
<td class="org-right">25</td>
</tr>
</tbody>
</table>
<ul class="org-ul">
<li>此种情况实践中比较少见，只能采用自编函数完成</li>
</ul>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #4f97d7;">options</span>(digits = 2)
<span style="color: #bc6ec5; font-weight: bold;">u.test</span><span style="color: #ce537a; font-weight: bold;">&lt;-</span><span style="color: #4f97d7; font-weight: bold;">function</span>(x,mu,thegma)
{  se=thegma/sqrt(length(x))
   u=(mean(x)-mu)/se
   p=pnorm(u)
   c(u=u, p=p)
}
b=c(22,24,21,24,23,24,23,22,21,25)
u.test(b, 25,2.4)

</pre>
</div>

<pre class="example">
      u       p 
-2.7670  0.0028 

</pre>
</div>
</div>

<div id="outline-container-org3e39909" class="outline-3">
<h3 id="org3e39909"><span class="section-number-3">3.15</span> 例子</h3>
<div class="outline-text-3" id="text-3-15">
<p>
一位投资者考虑是否选择新的资产管理公司，为使收益最大化，如果新的资产公司平均收益率大于原来资产管理公司的平均收益率，公司将选择新的资产管理公司。原来的资产公司的客户平均收益率为50.0%，对新资产管理公司的客户进行抽样检验，12个客户的收益率如下：50.2%，49.6%，51.0%，50.8%，50.6%，49.8%，51.2%，49.7%，51.5%，50.3%，51.0%和50.6%，假设资产管理公司客户收益率的分布比较近似于正态分布，问新资产管理公司的平均收益率是否大于原来的资产管理公司? 
</p>
<div class="org-src-container">
<pre class="src src-R">x=c(.502,.496,.510,.508,.506,.498,.512,.497,.515,.503,.510,.506)
t.test(x,mu=.500,alternative =<span style="color: #2d9574;">"greater"</span>) 
</pre>
</div>

<pre class="example">

	One Sample t-test

data:  x
t = 2.9564, df = 11, p-value = 0.006529
alternative hypothesis: true mean is greater than 0.5
95 percent confidence interval:
 0.5020609       Inf
sample estimates:
mean of x 
  0.50525 

</pre>
</div>
</div>

<div id="outline-container-org95c5f81" class="outline-3">
<h3 id="org95c5f81"><span class="section-number-3">3.16</span> 正态总体单样本参数假设检验</h3>
<div class="outline-text-3" id="text-3-16">
<ul class="org-ul">
<li><p>
总体比例的检验  
假定条件：
 总体服从二项分布；
 可用正态分布来近似（大样本）。  
</p>

<p>
检验的Z统计量：
</p></li>
</ul>
<p>
\[ z=\frac{\hat \pi-\pi_0}{\sqrt{\pi_0(1-\pi_0)/n}}\sim N(0,1)，\pi_0为假设的总体比例. \]
</p>

<ul class="org-ul">
<li>总体方差的检验  
检验一个总体的方差或标准差，假设总体近似服从正态分布，使用 &chi;<sup>2</sup> 分布。  
检验统计量：</li>
</ul>
<p>
\[ \chi^2=\frac{(n-1)s^2}{\sigma_0^2}\sim \chi^2(n-1)\]
</p>
</div>
</div>

<div id="outline-container-org9064248" class="outline-3">
<h3 id="org9064248"><span class="section-number-3">3.17</span> 总体比例检验示例</h3>
<div class="outline-text-3" id="text-3-17">
<p>
为调查某大学男女比率是否是1:1，在校门处观察，发现100学生中有45个女性。那么，这是否支持该大学总体男性占比为50%的假设？
</p>
<div class="org-src-container">
<pre class="src src-R">prop.test(45,100,p=0.5)
</pre>
</div>

<pre class="example">

	1-sample proportions test with continuity correction

data:  45 out of 100, null probability 0.5
X-squared = 0.81, df = 1, p-value = 0.3681
alternative hypothesis: true p is not equal to 0.5
95 percent confidence interval:
 0.3514281 0.5524574
sample estimates:
   p 
0.45 

</pre>
</div>
</div>

<div id="outline-container-org5f40989" class="outline-3">
<h3 id="org5f40989"><span class="section-number-3">3.18</span> 总体方差检验示例</h3>
<div class="outline-text-3" id="text-3-18">
<p>
某地区环保部门规定，废水经设备处理后水中某种有毒物质的平均浓度，均值和标准差单位是微克。通过抽查20个废水样品，如何判断水样的标准差是否为20微克？
</p>
<ul class="org-ul">
<li>只能采用自编函数var.test1完成，R里面的var.test函数是用来比较两个对象的。</li>
</ul>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #bc6ec5; font-weight: bold;">var.test1</span><span style="color: #ce537a; font-weight: bold;">&lt;-</span><span style="color: #4f97d7; font-weight: bold;">function</span>(x, sigma2){
  n<span style="color: #ce537a; font-weight: bold;">&lt;-</span>length(x)
  svar=var(x)
  df=n-1
  chi2<span style="color: #ce537a; font-weight: bold;">&lt;-</span>df*svar/sigma2;
  P<span style="color: #ce537a; font-weight: bold;">&lt;-</span>pchisq(chi2,df)
  data.frame(var=svar, df=df, chisq2=chi2, P_value=P)
}
x=c(512.952899108198, 503.85274864927, 495.06951127009, 477.193305294993, 509.400520346022, 493.249014260413, 492.456674317536, 530.078195416527, 498.757258963417, 522.657000900506, 510.041124496973, 490.505063978937, 536.24855605503, 530.039965979141, 495.559165160148, 466.840695851664, 510.702680801237, 524.485012890925, 490.37616974915, 485.579333872921)
var.test1(x,400)
</pre>
</div>

<pre class="example">
       var df   chisq2   P_value
1 346.8209 19 16.47399 0.3745438

</pre>
</div>
</div>

<div id="outline-container-orgabb9660" class="outline-3">
<h3 id="orgabb9660"><span class="section-number-3">3.19</span> 正态总体双样本参数假设检验</h3>
<div class="outline-text-3" id="text-3-19">
</div>
<ol class="org-ol">
<li><a id="orgb8ddaf3"></a>双样本方差的检验（方差齐性检验）<br />
<div class="outline-text-4" id="text-3-19-1">
<p>
假定条件：
 两个总体都服从正态分布。
 两个独立的随机样本。
</p>

<p>
检验统计量：
\[ F=\frac{s_1^2}{s_2^2}\sim F(n_1-1,n_2-1)\ 或 \ F=\frac{s_2^2}{s_1^2}\sim F(n_2-1,n_1-1)\]
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org6272bfc" class="outline-3">
<h3 id="org6272bfc"><span class="section-number-3">3.20</span> 例子</h3>
<div class="outline-text-3" id="text-3-20">
<p>
假设您是一个轮胎生产商，您从两个厂家买入轮轴，假设每个轮轴的直径服从正态分布，请问如何检验两者方差大小？
</p>
<div class="org-src-container">
<pre class="src src-R">x1=c(24, 29, 39, 40, 32, 32, 31, 44, 37, 37, 50, 28, 24, 48, 25, 40, 32, 34, 35, 41)
x2=c(44, 34, 36, 38, 30, 30, 35, 38, 40, 46, 38, 35, 38, 36, 38, 40, 34, 37, 40, 46)
var.test(x1,x2)
</pre>
</div>

<pre class="example">

	F test to compare two variances

data:  x1 and x2
F = 2.9283, num df = 19, denom df = 19, p-value = 0.02385
alternative hypothesis: true ratio of variances is not equal to 1
95 percent confidence interval:
 1.159058 7.398216
sample estimates:
ratio of variances 
          2.928304 

</pre>
</div>
</div>

<div id="outline-container-org18e51d6" class="outline-3">
<h3 id="org18e51d6"><span class="section-number-3">3.21</span> 正态总体双样本参数假设检验</h3>
<div class="outline-text-3" id="text-3-21">
<p>
<b>两样本均值检验:</b>
将一个样本与另一样本均值相比较的检验，分为两独立样本检验和配对样本检验。
</p>
</div>
<ol class="org-ol">
<li><a id="org4756391"></a>两独立样本 t 检验（方差齐性）<br />
<div class="outline-text-4" id="text-3-21-1">
<p>
假定条件：
 两个样本是独立的随机样本。
 两个总体都是正态分布。  
 两个总体的方差 \(\sigma_1^2，\sigma_2^2未知但相等，即\sigma_1^2=\sigma_2^2。\)  
检验统计量：
</p>

<p>
\[t=\frac{(\bar x_1-\bar x_2)-(\mu_1-\mu_2)}{s_p\sqrt{\frac{1}{n_1}+\frac{1}{n_2}}}，其中s_p=\frac{(n_1-1)s_1^2+(n_2-1)s_2^2}{n_1+n_2-2}，自由度：n_1+n_2-2\]
</p>
</div>
</li>
<li><a id="orgd16d7bd"></a>两独立样本 t 检验（方差不齐时）：<br />
<div class="outline-text-4" id="text-3-21-2">
<p>
\(\sigma_1^2，\sigma_2^2未知且不相等，即\sigma_1^2\ne\sigma_2^2。\)
\[t=\frac{(\bar x_1-\bar x_2)-(\mu_1-\mu_2)}{\sqrt{\frac{s_1^2}{n_1}+\frac{s_2^2}{n_2}}}，自由度：最接近v的整数——v=\frac{(\frac{s_1^2}{n_1}+\frac{s_2^2}{n_2})^2}{\frac{(s_1^2/n_1)^2}{n_1-1}+\frac{(s_2^2/n_2)^2}{n_2-1}}\]
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org108306a" class="outline-3">
<h3 id="org108306a"><span class="section-number-3">3.22</span> 例子</h3>
<div class="outline-text-3" id="text-3-22">
<p>
一员工对乘当地公交车上班快还是自己开车快的问题产生了兴趣。通过对两种方式所用时间各进行了10次记录，具体数据见下表。设每一种方式的天数是随机选取的，假设乘车时间服从正态分布。这些数据能提供充分的证据说明开车去的平均时间快吗？
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">公交</th>
<th scope="col" class="org-right">48</th>
<th scope="col" class="org-right">47</th>
<th scope="col" class="org-right">44</th>
<th scope="col" class="org-right">45</th>
<th scope="col" class="org-right">46</th>
<th scope="col" class="org-right">47</th>
<th scope="col" class="org-right">43</th>
<th scope="col" class="org-right">47</th>
<th scope="col" class="org-right">42</th>
<th scope="col" class="org-right">48</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">开车</td>
<td class="org-right">36</td>
<td class="org-right">45</td>
<td class="org-right">47</td>
<td class="org-right">38</td>
<td class="org-right">39</td>
<td class="org-right">42</td>
<td class="org-right">36</td>
<td class="org-right">42</td>
<td class="org-right">46</td>
<td class="org-right">35</td>
</tr>
</tbody>
</table>

<ol class="org-ol">
<li>两样本均值检验，需要先验证样本是否服从正态分布（后面介绍），如果已知总体服从正态，样本量较大就不需要。</li>
<li>判断两个样本是否有相同的方差</li>
<li>t 检验判断均值（t.test默认方差不等）</li>
</ol>

<div class="org-src-container">
<pre class="src src-R">x1=c(48,47,44,45,46,47,43,47,42,48)
x2=c(36,45,47,38,39,42,36,42,46,35)
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#26041;&#24046;&#40784;&#24615;&#26816;&#39564;</span>
var.test(x1,x2)
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">t &#26816;&#39564;&#21028;&#26029;&#22343;&#20540;</span>
t.test(x1,x2,var.equal = <span style="color: #a45bad;">FALSE</span>)
</pre>
</div>

<pre class="example">

	F test to compare two variances

data:  x1 and x2
F = 0.22732, num df = 9, denom df = 9, p-value = 0.03793
alternative hypothesis: true ratio of variances is not equal to 1
95 percent confidence interval:
 0.05646413 0.91520616
sample estimates:
ratio of variances 
         0.2273243 


	Welch Two Sample t-test

data:  x1 and x2
t = 3.2882, df = 12.891, p-value = 0.005939
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 1.746412 8.453588
sample estimates:
mean of x mean of y 
     45.7      40.6 

</pre>
</div>
</div>

<div id="outline-container-orge991ebe" class="outline-3">
<h3 id="orge991ebe"><span class="section-number-3">3.23</span> 正态总体双样本参数假设检验</h3>
<div class="outline-text-3" id="text-3-23">
</div>
<ol class="org-ol">
<li><a id="org1142176"></a>两配对样本 t 检验<br />
<div class="outline-text-4" id="text-3-23-1">
<p>
假定条件:
两个总体配对差值构成的总体服从正态分布。
配对差是由差值总体中随机抽取的。
数据配对或匹配(重复测量 (前/后))。
</p>

<p>
样本差值均值 \(\bar d=\frac{\sum_{i=1}^n d_i}{n_d}\)   
样本差值标准差值 \(s_d=\sqrt{\frac{\sum_{i=1}^n(d_i-\bar d)^2}{n_d-1}}\)
</p>

<p>
大样本检验统计量：
</p>

<p>
\[ z=\frac{\bar d-d_0}{s_d/\sqrt{n_d}}\sim N(0,1)\]
小样本检验统计量：
</p>

<p>
\[ t=\frac{\bar d-d_0}{s_d/\sqrt{n_d}}\sim t(n-1)\]
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org81acb87" class="outline-3">
<h3 id="org81acb87"><span class="section-number-3">3.24</span> 例子</h3>
<div class="outline-text-3" id="text-3-24">
<p>
一个减肥俱乐部声称，参加其训练班至少可以使肥胖者平均体重减轻8.5kg以上。为了验证该宣传是否可信，调查人员随机抽取了10名参加者，得到他们的体重记录如下：
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">训练前</th>
<th scope="col" class="org-right">94.5</th>
<th scope="col" class="org-right">101</th>
<th scope="col" class="org-right">110</th>
<th scope="col" class="org-right">103.5</th>
<th scope="col" class="org-right">97</th>
<th scope="col" class="org-right">88.5</th>
<th scope="col" class="org-right">96.5</th>
<th scope="col" class="org-right">101</th>
<th scope="col" class="org-right">104</th>
<th scope="col" class="org-right">116.5</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">训练后</td>
<td class="org-right">85</td>
<td class="org-right">89.5</td>
<td class="org-right">101.5</td>
<td class="org-right">96</td>
<td class="org-right">86</td>
<td class="org-right">80.5</td>
<td class="org-right">87</td>
<td class="org-right">93.5</td>
<td class="org-right">93</td>
<td class="org-right">102</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-R">before = c(94.5,101,110,103.5,97,88.5,96.5,101,104,116.5)
after = c(85,89.5,101.5,96,86,80.5,87,93.5,93,102)
t.test(before-after, mu=8.5, alternative = <span style="color: #2d9574;">"greater"</span>)
</pre>
</div>

<pre class="example">

	One Sample t-test

data:  before - after
t = 1.9413, df = 9, p-value = 0.04207
alternative hypothesis: true mean is greater than 8.5
95 percent confidence interval:
 8.575214      Inf
sample estimates:
mean of x 
     9.85 

</pre>
</div>
</div>


<div id="outline-container-org133361b" class="outline-3">
<h3 id="org133361b"><span class="section-number-3">3.25</span> 正态总体双样本参数假设检验</h3>
<div class="outline-text-3" id="text-3-25">
</div>
<ol class="org-ol">
<li><a id="org6673b7b"></a>两样本比例检验<br />
<div class="outline-text-4" id="text-3-25-1">
<p>
假定条件：
 两个总体都服从二项分布。
 可以用正态分布来近似。
</p>

<p>
检验统计量：  
检验 H<sub>0</sub> ： \(p_1-p_2=0\)
</p>

<p>
\[ z=\frac{\bar p_1-\bar p_2}{\sqrt{\bar p(1-\bar p)(\frac{1}{n_1}+\frac{1}{n_2})}}，其中\bar p=\frac{x_1+x_2}{n_1+n_2}=\frac{\bar p_1n_1+\bar p_2n_2}{n_1+n_2}\]
</p>

<p>
检验 H<sub>0</sub> ： \(p_1-p_2=d_0\)
</p>

<p>
\[ z=\frac{(\bar p_1-\bar p_2)-d_0}{\sqrt{\frac{\bar p_1(1-\bar p_1)}{n_1}+\frac{\bar p_2(1-\bar p_2)}{n_2}}}\]
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org2a8d539" class="outline-3">
<h3 id="org2a8d539"><span class="section-number-3">3.26</span> 例子</h3>
<div class="outline-text-3" id="text-3-26">
<p>
民意测验专家想知道某广告是否对观众产生明显影响，为此播出前后做了两次调查：
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-right">第一次</th>
<th scope="col" class="org-right">第二次</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">喜欢</td>
<td class="org-right">45</td>
<td class="org-right">56</td>
</tr>

<tr>
<td class="org-left">不喜欢</td>
<td class="org-right">35</td>
<td class="org-right">47</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-R">prop.test(c(45,56),c(45+35,56+47))
</pre>
</div>

<pre class="example">

	2-sample test for equality of proportions with continuity correction

data:  c(45, 56) out of c(45 + 35, 56 + 47)
X-squared = 0.010813, df = 1, p-value = 0.9172
alternative hypothesis: two.sided
95 percent confidence interval:
 -0.1374478  0.1750692
sample estimates:
   prop 1    prop 2 
0.5625000 0.5436893 

</pre>
</div>
</div>
</div>

<div id="outline-container-orga18e6c1" class="outline-2">
<h2 id="orga18e6c1"><span class="section-number-2">4</span> 非参数假设检验</h2>
<div class="outline-text-2" id="text-4">
</div>

<div id="outline-container-orgca3184f" class="outline-3">
<h3 id="orgca3184f"><span class="section-number-3">4.1</span> 非参数检验</h3>
<div class="outline-text-3" id="text-4-1">
<p>
参数假设检验是在假设总体分布已知的情况下进行的. 但实践中，难以对总体的分布进行假定. 数据并不是来自所假定分布的总体, 或者，数据根本不是来自一个总体.
</p>

<ul class="org-ul">
<li>单一样本的检验
<ul class="org-ul">
<li>位置参数的检验：用 Wilcoxon 符号秩检验替代 t 检验</li>
<li>分布一致性检验：卡方拟合优度检验和K-S单样本总体分布检验</li>
<li>常用正态性检验：Jarque-Bera检验、Shapiro-Wilk（W检验）等</li>
</ul></li>
<li>双样本比较与检验
<ul class="org-ul">
<li>卡方独立性检验和 Fisher 精确检验：两个类别变量是否相关（比较比例）</li>
<li>Wilcoxon 秩和检验法和 Mann-Whitney U 检验：替代 t 检验（比较均值）</li>
<li>卡方两样本同质性检验和K-S两独立样本同质性检验（比较分布）</li>
</ul></li>
<li>多样本的比较与检验
<ul class="org-ul">
<li>多个独立样本的 Kruskal-Wallis 秩和检验</li>
<li>多个相关样本的 Friedman 秩和检验</li>
<li>尺度参数的Ansari-Bradley检验和Fligner-Killeen检验</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org9aa66cf" class="outline-3">
<h3 id="org9aa66cf"><span class="section-number-3">4.2</span> 单一样本的检验</h3>
<div class="outline-text-3" id="text-4-2">
</div>
<ol class="org-ol">
<li><a id="org24962f9"></a>单一样本位置参数的检验<br />
<div class="outline-text-4" id="text-4-2-1">
<ul class="org-ul">
<li>前提：总体分布未知；小样本</li>
<li>方法：Wilcoxon 符号秩检验</li>
</ul>

<p>
例子：某保险公司2016年车险索赔数额（单位：元）的随机抽样为（按升幂排列）：4632, 4728, 5052, 5064, 5484, 6972, 7696, 9048, 14760, 15013, 18730,21240, 22836, 52788, 67200. 已知2015年的索赔数额的中位数为6064元. 问2016年索赔的中位数与前一年是否有所变化?
</p>
<div class="org-src-container">
<pre class="src src-R">insure<span style="color: #ce537a; font-weight: bold;">&lt;-</span>c(4632, 4728, 5052, 5064, 5484, 6972, 7696, 9048, 14760, 15013, 18730, 21240, 22836, 52788, 67200)
wilcox.test(insure,mu=6064)
</pre>
</div>

<pre class="example">

	Wilcoxon signed rank exact test

data:  insure
V = 101, p-value = 0.01807
alternative hypothesis: true location is not equal to 6064


</pre>
</div>
</li>

<li><a id="orgb3d6406"></a>卡方拟合优度检验<br />
<div class="outline-text-4" id="text-4-2-2">
<p>
卡方拟合优度检验(Chi-squared goodness of fit tests)用来检验样本是否来自于特定类型分布的一种假设检验。  
</p>
<ul class="org-ul">
<li>前提：适用于验证离散型分布，也可验证连续型分布，但会有信息丢失</li>
</ul>
<p>
如果掷一骰子150次并得到以下分布数据，此骰子是均匀的吗?   
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">点数</th>
<th scope="col" class="org-right">1</th>
<th scope="col" class="org-right">2</th>
<th scope="col" class="org-right">3</th>
<th scope="col" class="org-right">4</th>
<th scope="col" class="org-right">5</th>
<th scope="col" class="org-right">6</th>
<th scope="col" class="org-right">合计</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">出现次数</td>
<td class="org-right">22</td>
<td class="org-right">21</td>
<td class="org-right">22</td>
<td class="org-right">27</td>
<td class="org-right">22</td>
<td class="org-right">36</td>
<td class="org-right">150</td>
</tr>
</tbody>
</table>

<p>
\[\chi^2=\sum_{i=1}^n \frac{(f_i-e_i)^2}{e_i},\ f_i为观察到的第i类数据出现的频数，e_i为第i类数据出现的理论频数\]
</p>
<div class="org-src-container">
<pre class="src src-R">freq =c(22,21,22,27,22,36)
probs = c(1,1,1,1,1,1)/6        <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#25351;&#23450;&#29702;&#35770;&#27010;&#29575;&#65288;&#22343;&#21248;&#20998;&#24067;&#65289;</span>
chisq.test(freq,p=probs)
</pre>
</div>

<pre class="example">

	Chi-squared test for given probabilities

data:  freq
X-squared = 6.72, df = 5, p-value = 0.2423


</pre>
</div>
</li>

<li><a id="orgf991280"></a>K-S单样本总体分布检验（验证连续型分布）<br />
<div class="outline-text-4" id="text-4-2-3">
<div class="org-src-container">
<pre class="src src-R">x=rnorm(50)
y=runif(50,0,1)
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#39564;&#35777;&#26159;&#21542;&#20026;&#22343;&#20540;&#20026;0&#65292;&#26631;&#20934;&#24046;&#20026;1&#30340;&#27491;&#24577;&#20998;&#24067;</span>
ks.test(x, <span style="color: #2d9574;">"pnorm"</span>, mean=0, sd=1)
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#39564;&#35777;&#26159;&#21542;&#20026;[0,1]&#30340;&#22343;&#21248;&#20998;&#24067;</span>
ks.test(y, <span style="color: #2d9574;">"punif"</span>, 0,1 )
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#39564;&#35777;&#26159;&#21542;&#20026;&#21442;&#25968;&#20026;0.5&#30340;&#25351;&#25968;&#20998;&#24067;</span>
ks.test(x,<span style="color: #2d9574;">"pexp"</span>,0.5)
</pre>
</div>

<pre class="example">

	One-sample Kolmogorov-Smirnov test

data:  x
D = 0.12382, p-value = 0.3951
alternative hypothesis: two-sided


	One-sample Kolmogorov-Smirnov test

data:  y
D = 0.095753, p-value = 0.7129
alternative hypothesis: two-sided


	One-sample Kolmogorov-Smirnov test

data:  x
D = 0.48198, p-value = 3.283e-11
alternative hypothesis: two-sided

</pre>
</div>
</li>
</ol>
</div>

<div id="outline-container-org6016302" class="outline-3">
<h3 id="org6016302"><span class="section-number-3">4.3</span> 常用正态分布检验</h3>
<div class="outline-text-3" id="text-4-3">
<ul class="org-ul">
<li>Jarque-Bera检验(偏度和峰度的联合分布检验法)</li>
</ul>
<p>
样本偏度和样本峰度可以联合起来作为正态性检验问题的检验统计量。  
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #4f97d7;">library</span>(tseries)
jarque.bera.test(mtcars$mpg)
</pre>
</div>

<ul class="org-ul">
<li>一元正态性检验：夏皮洛—威尔克(Shapiro-Wilk)检验（或者W检验）</li>
</ul>
<p>
当 8≤n≤50 时使用，小样本 n&lt;8 检验效果不好，大样本使用K-S检验。
</p>
<div class="org-src-container">
<pre class="src src-R">shapiro.test(mtcars$mpg)
</pre>
</div>

<pre class="example">

	Shapiro-Wilk normality test

data:  mtcars$mpg
W = 0.94756, p-value = 0.1229


</pre>

<ul class="org-ul">
<li>其他正态分布检验（独立性）
<ul class="org-ul">
<li>AD正态性检验(ad.test)</li>
<li>Cramer-von Mises正态性检验(cvm.test)</li>
<li>Lilliefors 正态性检验(lillie.test)</li>
<li>Pearson 卡方正态性检验(pearson.test)</li>
<li>Shapiro-Francia正态性检验(sf.test)</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org0115152" class="outline-3">
<h3 id="org0115152"><span class="section-number-3">4.4</span> 双样本比较与检验</h3>
<div class="outline-text-3" id="text-4-4">
</div>
<ol class="org-ol">
<li><a id="orge441b9e"></a>卡方独立性检验（Chi-squared tests of independence）<br />
<div class="outline-text-4" id="text-4-4-1">
<p>
在两个分类变量相互独立的原假设下，比较理论频数和实际频数的吻合程度。
</p>

<p>
\[\chi^2=\sum_{i=1}^r\sum_{k=1}^s[n_{ij}-\frac{n_{i.}n_{.j}}{n}]^2/\frac{n_{i.}n_{.j}}{n} \ \sim \ \chi^2((r-1)(s-1))\]
</p>

<p>
安全带与受伤程度的独立性检验  
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">受伤情况</th>
<th scope="col" class="org-right">无</th>
<th scope="col" class="org-right">轻微</th>
<th scope="col" class="org-right">较重</th>
<th scope="col" class="org-right">严重</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">系安全带</td>
<td class="org-right">12813</td>
<td class="org-right">647</td>
<td class="org-right">359</td>
<td class="org-right">42</td>
</tr>

<tr>
<td class="org-left">没系</td>
<td class="org-right">65963</td>
<td class="org-right">4000</td>
<td class="org-right">2642</td>
<td class="org-right">303</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-R">yesbelt = c(12813,647,359,42)
nobelt = c(65963,4000,2642,303)
chisq.test(rbind(yesbelt,nobelt))
</pre>
</div>

<pre class="example">

	Pearson's Chi-squared test

data:  rbind(yesbelt, nobelt)
X-squared = 59.224, df = 3, p-value = 8.61e-13


</pre>
</div>
</li>
</ol>
</div>

<div id="outline-container-org97bdfe3" class="outline-3">
<h3 id="org97bdfe3"><span class="section-number-3">4.5</span> 双样本比较与检验（独立性）</h3>
<div class="outline-text-3" id="text-4-5">
<ul class="org-ul">
<li>Fisher 精确检验：当每个样本在每个类别上的结果（列联表单元格中的观察数）小于5个时采用</li>
</ul>
<div class="org-src-container">
<pre class="src src-R">compare<span style="color: #ce537a; font-weight: bold;">&lt;-</span>matrix(c(60,32,3,11),nr = 2, dimnames = list(c(<span style="color: #2d9574;">"cancer"</span>, <span style="color: #2d9574;">"normal"</span>), c(<span style="color: #2d9574;">"smoke"</span>, <span style="color: #2d9574;">"Not smoke"</span>)))
fisher.test(compare, alternative = <span style="color: #2d9574;">"greater"</span>)
</pre>
</div>

<pre class="example">

	Fisher's Exact Test for Count Data

data:  compare
p-value = 0.002467
alternative hypothesis: true odds ratio is greater than 1
95 percent confidence interval:
 1.950434      Inf
sample estimates:
odds ratio 
   6.74691 

</pre>
</div>
</div>

<div id="outline-container-org3e415ec" class="outline-3">
<h3 id="org3e415ec"><span class="section-number-3">4.6</span> 双样本比较与检验（比较中心位置）</h3>
<div class="outline-text-3" id="text-4-6">
<ul class="org-ul">
<li>Wilcoxon 秩和检验法</li>
</ul>
<p>
在不知总体分布时, 使用 t 检验可能有风险. 考虑采用Wilcoxon秩和检验法.    
Mann-Whitney U 检验与Wilcoxon检验统计量几乎相同。
</p>

<p>
有糖尿病的和正常的老鼠重量为(单位:克)  
糖尿病鼠:42, 44, 38, 52, 48, 46, 34, 44, 38;  
正常老鼠:34, 43, 35, 33, 34, 26, 30, 31, 31, 27, 28, 27, 30, 37, 32.  
</p>
<div class="org-src-container">
<pre class="src src-R">diabetes<span style="color: #ce537a; font-weight: bold;">&lt;-</span>c(42,44,38,52,48,46,34,44,38)
normal<span style="color: #ce537a; font-weight: bold;">&lt;-</span>c(34,43,35,33,34,26,30,31,31,27,28,27,30,37,32)
wilcox.test(diabetes,normal)
</pre>
</div>

<pre class="example">

	Wilcoxon rank sum test with continuity correction

data:  diabetes and normal
W = 128, p-value = 0.0003374
alternative hypothesis: true location shift is not equal to 0


</pre>
</div>
</div>

<div id="outline-container-org1a7ccae" class="outline-3">
<h3 id="org1a7ccae"><span class="section-number-3">4.7</span> 双样本比较与检验（同分布检验）</h3>
<div class="outline-text-3" id="text-4-7">
<ul class="org-ul">
<li>卡方两样本同质性检验(Chi-squared tests for homogeneity)</li>
</ul>
<p>
用来检验各行是否来自同一个总体。如果各行因子来自于相同的总体，每一类的出现概率应该是差不多的。过程与 <b>卡方独立性检验</b> 一样，原假设为两样本来自同一个总体。  
</p>

<ul class="org-ul">
<li>K-S两独立样本同质性检验</li>
</ul>
<p>
假定有分别来自两个独立总体的样本，想要检验其总体分布相同的原假设。
</p>
<div class="org-src-container">
<pre class="src src-R">x1=c(48,47,44,45,46,47,43,47,42,48)  
x2=c(36,45,47,38,39,42,36,42,46,35)  
ks.test(x1,x2) 
</pre>
</div>

<pre class="example">

	Two-sample Kolmogorov-Smirnov test

data:  x1 and x2
D = 0.6, p-value = 0.05465
alternative hypothesis: two-sided


</pre>
</div>
</div>

<div id="outline-container-org0d989d3" class="outline-3">
<h3 id="org0d989d3"><span class="section-number-3">4.8</span> 多样本的比较与检验（比较位置参数）</h3>
<div class="outline-text-3" id="text-4-8">
<ul class="org-ul">
<li>多个独立样本的Kruskal-Wallis 秩和检验  
在数据非正态的情况下代替单因素方差分析，原假设为各总体中心位置都相等</li>
</ul>

<p>
学校要对300份奖学金申请进行评价，安排了3个评价人。为检查评价人标准是否一致，随机选择比较3个评价人的评分。评分等级不服从正态假定，采用非参数检验。  
</p>

<p>
评价者1：4，3，4，5，2，3，4，5，4，4，5，4   
评价者2：4，4，5，5，4，5，4，4，5，5，4，5   
评价者3：3，4，2，4，4，5，3，4，2，2，1，1  
</p>
<div class="org-src-container">
<pre class="src src-R">scores = c(4,3,4,5,2,3,4,5,4,4,5,5,4,5,4,4,3,4,2,4,5,5,4,4)
person = c(1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3)
kruskal.test(scores ~ person)
</pre>
</div>

<pre class="example">

	Kruskal-Wallis rank sum test

data:  scores by person
Kruskal-Wallis chi-squared = 1.9387, df = 2, p-value = 0.3793


</pre>
</div>
</div>

<div id="outline-container-orge4f3a26" class="outline-3">
<h3 id="orge4f3a26"><span class="section-number-3">4.9</span> 多样本的比较与检验（比较位置参数）</h3>
<div class="outline-text-3" id="text-4-9">
<ul class="org-ul">
<li>多个相关样本的 Friedman 秩和检验  
在数据严重偏态且样本量较小的情况下代替重复测量的方差分析</li>
</ul>

<p>
检验相同被试对3个影响因素的评分  
分数表示：-2=非常负面，-1=负面，0=中性，1=积极，2=非常积极]
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">影响因素</th>
<th scope="col" class="org-right">1</th>
<th scope="col" class="org-right">2</th>
<th scope="col" class="org-right">3</th>
<th scope="col" class="org-right">4</th>
<th scope="col" class="org-right">5</th>
<th scope="col" class="org-right">6</th>
<th scope="col" class="org-right">7</th>
<th scope="col" class="org-right">8</th>
<th scope="col" class="org-right">9</th>
<th scope="col" class="org-right">10</th>
<th scope="col" class="org-right">11</th>
<th scope="col" class="org-right">12</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">电影</td>
<td class="org-right">-1</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">2</td>
<td class="org-right">0</td>
<td class="org-right">-2</td>
<td class="org-right">-1</td>
<td class="org-right">0</td>
<td class="org-right">-1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">-1</td>
</tr>

<tr>
<td class="org-left">电视</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">-1</td>
<td class="org-right">-2</td>
<td class="org-right">-1</td>
<td class="org-right">1</td>
<td class="org-right">-1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">-1</td>
</tr>

<tr>
<td class="org-left">摇滚</td>
<td class="org-right">-1</td>
<td class="org-right">0</td>
<td class="org-right">-2</td>
<td class="org-right">1</td>
<td class="org-right">-1</td>
<td class="org-right">-2</td>
<td class="org-right">0</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">1</td>
<td class="org-right">-1</td>
<td class="org-right">-2</td>
</tr>
</tbody>
</table>
<div class="org-src-container">
<pre class="src src-R">evaluation = matrix(c(-1,0,-1,1,0,0,0,1,-2,2,0,1,0,-1,-1,-2,-2,-2,-1,-1,0,0,1,-1,-1,-1,-1,1,0,1,1,1,1,-1,-1,-2),nrow=12,byrow=<span style="color: #a45bad;">TRUE</span>)
friedman.test(evaluation)
</pre>
</div>

<pre class="example">

	Friedman rank sum test

data:  evaluation
Friedman chi-squared = 2.4, df = 2, p-value = 0.3012


</pre>
</div>
</div>


<div id="outline-container-org873ddf4" class="outline-3">
<h3 id="org873ddf4"><span class="section-number-3">4.10</span> 多样本的比较与检验（比较尺度参数）</h3>
<div class="outline-text-3" id="text-4-10">
<ul class="org-ul">
<li>尺度参数的Ansari-Bradley检验和Fligner-Killeen检验  
多个样本总体均值相等条件下，检验总体方差是否相等</li>
</ul>

<p>
三名运动员比赛打靶，各打10发子弹，打中的环数 A：[8, 7, 9, 10, 9, 6, 5, 8, 10, 5]；B：[8, 7, 9, 6, 8, 9, 10, 7, 8, 9]；C：[10, 10, 9, 6, 8, 3, 5, 6, 7, 4]. 问这三名运动员的稳定性是否一样？
</p>
<div class="org-src-container">
<pre class="src src-R">x<span style="color: #ce537a; font-weight: bold;">&lt;-</span>list(A=c(8,7,9,10,9,6,5,8,10,5), B=c(8,7,9,6,8,9,10,7,8,9), C=c(10,10,9,6,8,3,5,6,7,4))
fligner.test(x)

ansari.test(x$A,x$B)
</pre>
</div>

<pre class="example">

	Fligner-Killeen test of homogeneity of variances

data:  x
Fligner-Killeen:med chi-squared = 5.1905, df = 2, p-value = 0.07463


	Ansari-Bradley test

data:  x$A and x$B
AB = 48.5, p-value = 0.3972
alternative hypothesis: true ratio of scales is not equal to 1

</pre>
</div>
</div>

<div id="outline-container-orga9d3904" class="outline-3">
<h3 id="orga9d3904"><span class="section-number-3">4.11</span> 补充作业需要的代码</h3>
<div class="outline-text-3" id="text-4-11">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#36830;&#32493;&#21464;&#37327;&#36716;&#21270;&#20026;&#31867;&#21035;&#21464;&#37327;</span>
x <span style="color: #ce537a; font-weight: bold;">&lt;-</span> c(1,0,1,1,0,0,1)
xfac <span style="color: #ce537a; font-weight: bold;">&lt;-</span> factor(x)

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#36830;&#32493;&#21464;&#37327;&#36716;&#21270;&#20026;&#26377;&#24207;&#21464;&#37327;</span>
y <span style="color: #ce537a; font-weight: bold;">&lt;-</span> c(rep(1,5),rep(2,4),rep(3,6))
yord <span style="color: #ce537a; font-weight: bold;">&lt;-</span> ordered(y)

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#31665;&#32447;&#22270;</span>
boxplot(mtcars$wt)
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#20998;&#31867;&#31665;&#32447;&#22270;</span>
boxplot(mtcars$wt~mtcars$am)

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org748c5e8" class="outline-2">
<h2 id="org748c5e8"><span class="section-number-2">5</span> 信度检验</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org95cd35d" class="outline-3">
<h3 id="org95cd35d"><span class="section-number-3">5.1</span> 信度</h3>
</div>
</div>

<div id="outline-container-org91ae5d6" class="outline-2">
<h2 id="org91ae5d6"><span class="section-number-2">6</span> 因子分析</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-orgb0f7b71" class="outline-3">
<h3 id="orgb0f7b71"><span class="section-number-3">6.1</span> 主成分分析和因子分析的区别</h3>
<div class="outline-text-3" id="text-6-1">
<ul class="org-ul">
<li>主成分分析（Principle Component Analysis）是数据降维技术，它能将大量相关变量转化为较少的不相关的变量，并且尽可能保留原始数据的信息，这些不相关的变量就是主成分。  
<ul class="org-ul">
<li>例如，定制衣服时，需要测量人体的许多尺寸，如上体长、手臂长、胸围、颈围、总肩宽等. 可以选出它们的某个线性组合，使之基本能够刻画人对服装的要求这个线性组合就是诸多尺寸的主成分.</li>
</ul></li>
</ul>


<ul class="org-ul">
<li>因子分析（Factor Analysis）是通过寻找数据中隐藏的结构来解释观测变量间的关系，隐藏的结构就用潜在的因子来表示，因子之间是可以相关的。
<ul class="org-ul">
<li>为了测验中学生的知识与能力，出40道题目让学生回答，每道题目单独计分，希望找出有限个不可观测的潜在变量来解释这40个随机变量。这种不可观测的潜在变量一般不能表示为原来随机变量的线性组合，但却是有实际意义的，例如语言表达能力、推理能力、艺术修养能力、历史知识和生活常识等。</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org74b9c87" class="outline-3">
<h3 id="org74b9c87"><span class="section-number-3">6.2</span> 主要步骤：</h3>
<div class="outline-text-3" id="text-6-2">
<ul class="org-ul">
<li>数据预处理：一般程序会自动标准化</li>
<li>选择模型：主成分分析还是因子分析</li>
<li>判断要选择的主成分/因子的个数</li>
<li>选择主成分/因子</li>
<li>旋转主成分/因子</li>
<li>解释结果</li>
<li>计算主成分或因子得分</li>
</ul>
</div>
</div>

<div id="outline-container-orge8a4eff" class="outline-3">
<h3 id="orge8a4eff"><span class="section-number-3">6.3</span> 主成分分析</h3>
<div class="outline-text-3" id="text-6-3">
<ul class="org-ul">
<li>假设数据集有p个指标，可看作p个随机变量 $X<sub>1</sub>， X<sub>2</sub>， &ctdot;，X<sub>p</sub>$，主成分分析就把这个p指标转变为p个指标的线性组合，而这些新的指标 \(F_1， F_2， \cdots， F_k(k\le p)\) 要充分反映原指标的信息，并且相互独立。</li>
</ul>

<p>
\[F_1=u_{11}X_1+u_{21}X_2+\cdots+u_{p1}X_p \\ F_2=u_{12}X_1+u_{22}X_2+\cdots+u_{p2}X_p \\ \cdots \\ F_p=u_{1p}X_1+u_{2p}X_2+\cdots+u_{pp}X_p\]
</p>

<ul class="org-ul">
<li>要求满足：  
<ul class="org-ul">
<li>每个主成分的系数平方和为1。即
\[u_{1i}^2+u_{2i}^2+\cdots+u_{pi}^2=1\]</li>
<li>主成分之间相互独立，即无重叠的信息。即
\[ Cov(F_i，F_j）=0，i\neq j,i,j=1,2，\cdots，p \]</li>
<li>主成分的方差依次递减，重要性依次递减，即
\[ Var(F_1)\ge Var(F_2)\ge \cdots \ge Var(F_p) \]</li>
</ul></li>

<li>判断主成分的个数
<ul class="org-ul">
<li>基于特征值：特征值代表主成分所解释的方差，保留特征值大于1的主成分</li>
<li>基于碎石图：保留碎石图上变化最大处之上的主成分</li>
<li>平行分析：如果真实数据的特征值大于随机数据矩阵的平均特征值，则保留</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #4f97d7;">library</span>(psych)

fa.parallel(USJudgeRatings[,-1], fa=<span style="color: #2d9574;">"pc"</span>)
</pre>
</div>


<div class="figure">
<p><img src="4.png" alt="4.png" />
</p>
</div>

<p>
1 提取主成分   
</p>

<ul class="org-ul">
<li>principal(r, nfactors=, rotate=, scores=)  
<ul class="org-ul">
<li>其中：r是相关系数矩阵或原始数据矩阵；nfactors设定主成分的个数；rotate指定旋转的方法（默认为最大方差旋转varimax）；scores设定是否需要计算主成分得分（默认不需要）</li>
</ul></li>
</ul>


<div class="org-src-container">
<pre class="src src-R">pc <span style="color: #ce537a; font-weight: bold;">&lt;-</span> principal(USJudgeRatings[,-1], nfactors=1)
pc
</pre>
</div>

<pre class="example">

Principal Components Analysis
Call: principal(r = USJudgeRatings[, -1], nfactors = 1)
Standardized loadings (pattern matrix) based upon correlation matrix
      PC1   h2     u2 com
INTG 0.92 0.84 0.1565   1
DMNR 0.91 0.83 0.1663   1
DILG 0.97 0.94 0.0613   1
CFMG 0.96 0.93 0.0720   1
DECI 0.96 0.92 0.0763   1
PREP 0.98 0.97 0.0299   1
FAMI 0.98 0.95 0.0469   1
ORAL 1.00 0.99 0.0091   1
WRIT 0.99 0.98 0.0196   1
PHYS 0.89 0.80 0.2013   1
RTEN 0.99 0.97 0.0275   1

                 PC1
SS loadings    10.13
Proportion Var  0.92

Mean item complexity =  1
Test of the hypothesis that 1 component is sufficient.

The root mean square of the residuals (RMSR) is  0.04 
 with the empirical chi square  6.21  with prob &lt;  1 

Fit based upon off diagonal values =
</pre>

<ul class="org-ul">
<li>PC1 列为成分载荷，即观测变量与第一主成分的相关系数。成分载荷可以用来解释主成分的含义。</li>
</ul>

<p>
\[\rho(x_i,F_j)=\frac{u_{ij}\lambda_j}{\sigma_i\sqrt{\lambda_j}}=\frac{u_{ij}\sqrt{\lambda_j}}{\sigma_i}\]
</p>

<ul class="org-ul">
<li>h2列为成分公因子方差（communality），即原始变量信息的被提取率，所有主成分对每个变量的方差解释度，数值为观测变量与所有主成分的相关系数的平方和；而 u2 列为成分唯一性（uniqueniesses），即变量方差中无法被主成分解释的比例，数值为1-h2.</li>

<li>SS loadings 为与某个主成分相关联的特征值 \(\lambda_j\) ；Proportion Var 为某个主成分对整个数据集的解释程度或贡献率，数值上为其相关联的特征值在特征值总和中所占的比例；Cumulative Var 为到某个主成分为止的主成分累计的解释度或累计贡献率，数值上为特征值占特征值总和累计比例。</li>
</ul>

<p>
\[\lambda_i/\sum_{i=1}^p\lambda_i,\qquad \sum_{i=1}^k\lambda_i/\sum_{i=1}^p\lambda_i\]
</p>

<p>
1.主成分旋转  
</p>
<ul class="org-ul">
<li>旋转的目的是将载荷矩阵变得更容易解释，尽可能去除掉主成分中的噪声。</li>
<li>两种旋转方式：  
<ul class="org-ul">
<li>正交旋转：保持主成分不相关，最常用的正交旋转是方差极大旋转，它尽量使得载荷矩阵的列只有少数几个很大的载荷。</li>
<li>斜交旋转：允许主成分相关</li>
</ul></li>
</ul>


<div class="org-src-container">
<pre class="src src-R">principal(Harman23.cor$cov, nfactors=2, rotate=<span style="color: #2d9574;">"none"</span>) 
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#26041;&#24046;&#26497;&#22823;&#26059;&#36716;</span>
principal(Harman23.cor$cov, nfactors=2, rotate=<span style="color: #2d9574;">"varimax"</span>)

</pre>
</div>

<pre class="example">
Principal Components Analysis
Call: principal(r = Harman23.cor$cov, nfactors = 2, rotate = "none")
Standardized loadings (pattern matrix) based upon correlation matrix
                PC1   PC2   h2    u2 com
height         0.86 -0.37 0.88 0.123 1.4
arm.span       0.84 -0.44 0.90 0.097 1.5
forearm        0.81 -0.46 0.87 0.128 1.6
lower.leg      0.84 -0.40 0.86 0.139 1.4
weight         0.76  0.52 0.85 0.150 1.8
bitro.diameter 0.67  0.53 0.74 0.261 1.9
chest.girth    0.62  0.58 0.72 0.283 2.0
chest.width    0.67  0.42 0.62 0.375 1.7

                       PC1  PC2
SS loadings           4.67 1.77
Proportion Var        0.58 0.22
Cumulative Var        0.58 0.81
Proportion Explained  0.73 0.27
Cumulative Proportion 0.73 1.00

Mean item complexity =  1.7
Test of the hypothesis that 2 components are sufficient.

The root mean square of the residuals (RMSR) is  0.05 

Fit based upon off diagonal values =

Principal Components Analysis
Call: principal(r = Harman23.cor$cov, nfactors = 2, rotate = "varimax")
Standardized loadings (pattern matrix) based upon correlation matrix
                RC1  RC2   h2    u2 com
height         0.90 0.25 0.88 0.123 1.2
arm.span       0.93 0.19 0.90 0.097 1.1
forearm        0.92 0.16 0.87 0.128 1.1
lower.leg      0.90 0.22 0.86 0.139 1.1
weight         0.26 0.88 0.85 0.150 1.2
bitro.diameter 0.19 0.84 0.74 0.261 1.1
chest.girth    0.11 0.84 0.72 0.283 1.0
chest.width    0.26 0.75 0.62 0.375 1.2

                       RC1  RC2
SS loadings           3.52 2.92
Proportion Var        0.44 0.37
Cumulative Var        0.44 0.81
Proportion Explained  0.55 0.45
Cumulative Proportion 0.55 1.00

Mean item complexity =  1.1
Test of the hypothesis that 2 components are sufficient.

The root mean square of the residuals (RMSR) is  0.05 

Fit based upon off diagonal values =
</pre>

<p>
1.获得主成分得分系数和得分  
</p>
<ul class="org-ul">
<li>主成分得分的系数原始变量线性组合的系数 \(u_{ij}\)</li>
<li>主成分得分即由原始变量降维后形成的新主成分的变量值（已标准化）。</li>
</ul>

<div class="org-src-container">
<pre class="src src-R">pc <span style="color: #ce537a; font-weight: bold;">&lt;-</span> principal(USJudgeRatings[,-1], nfactors=1, score=<span style="color: #a45bad;">TRUE</span>) 
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#20027;&#25104;&#20998;&#24471;&#20998;&#31995;&#25968;</span>
pc$weights
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#20027;&#25104;&#20998;&#24471;&#20998;</span>
head(pc$scores)

</pre>
</div>

<pre class="example">

            PC1
INTG 0.09063298
DMNR 0.09010751
DILG 0.09561212
CFMG 0.09506461
DECI 0.09484596
PREP 0.09719916
FAMI 0.09633895
ORAL 0.09823407
WRIT 0.09771359
PHYS 0.08819290
RTEN 0.09731516

                      PC1
AARONSON,L.H.  -0.1857981
ALEXANDER,J.M.  0.7469865
ARMENTANO,A.J.  0.0704772
BERDON,R.I.     1.1358765
BRACKEN,J.J.   -2.1586211
BURNS,E.B.      0.7669406
</pre>


<ul class="org-ul">
<li>由主成分分析可以生成一个新变量来替代11个原始变量，公式为：</li>
</ul>

<p>
\[PC1=0.091\times INTG+0.090\times DMNR+0.096\times DILG+\cdots +0.097\times RTEN\]
</p>
</div>
</div>

<div id="outline-container-orgdc21aeb" class="outline-3">
<h3 id="orgdc21aeb"><span class="section-number-3">6.4</span> 因子分析</h3>
<div class="outline-text-3" id="text-6-4">
<ul class="org-ul">
<li>设 \(X_i(i=1,2,\cdots,p)\) p个变量，如果表示为：</li>
</ul>

<p>
\[X_i=\mu_i+a_{i1}F_1+\cdots+a_{im}F_m+\varepsilon_i(m\le p)\] 
</p>

<ul class="org-ul">
<li>\(F_1,F_2,\cdots,F_m\) 称为公共因子，是不可观测的变量，它们的系数称为因子载荷。 \(\varepsilon_i\) 是特殊因子，是不可能被前m个公共因子包含的部分。</li>
</ul>

<p>
并且满足：
</p>
<ul class="org-ul">
<li>\(cov(F,\varepsilon)=0\) ，即 \(F,\varepsilon\) 不相关</li>
<li>\(F_1,F_2,\cdots,F_m\) 互不相关，方差为1</li>
<li>\(\varepsilon_i\sim N(0,\sigma_i^2)\) 互不相关，方差不一定相等</li>

<li>例子：对6个心理学测验进行分析。112个人参与了6个测验，包括普通智力测验（general）、画图测验（picture）、积木测验（blocks）、迷宫测验（maze）、阅读测验（reading）和词汇测验（vocab）。如何用一组较少的、潜在的心理学因素来解释参与者的测验得分？</li>

<li>判断提取公共因子的个数：取高不取低</li>
</ul>
<div class="org-src-container">
<pre class="src src-R">covariances <span style="color: #ce537a; font-weight: bold;">&lt;-</span> ability.cov$cov
correlations <span style="color: #ce537a; font-weight: bold;">&lt;-</span> cov2cor(covariances)
fa.parallel(correlations, n.obs=112, fa=<span style="color: #2d9574;">"fa"</span>)

</pre>
</div>


<div class="figure">
<p><img src="5.png" alt="5.png" />
</p>
</div>

<ol class="org-ol">
<li>提取公共因子  
<ul class="org-ul">
<li>fa(r, nfactors=, n.obs=, rotate=, scores=, fm=)]
<ul class="org-ul">
<li>其中：r 是相关系数矩阵或原始数据矩阵；nfactors设定提取因子个数；n.obs是观测数（r是相关系数矩阵时需要提供）；rotate指定旋转的方法（默认为互变异数最小法"oblimin"）；scores设定是否计算因子得分（默认不计算）；fm设定因子化方法（默认极小残差法"minres"，常用最大似然法"ml"，主轴迭代法"pa"）</li>
</ul></li>
</ul></li>
</ol>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#26410;&#26059;&#36716;&#30340;&#20027;&#36724;&#36845;&#20195;&#22240;&#23376;&#27861;</span>
fa <span style="color: #ce537a; font-weight: bold;">&lt;-</span> fa(correlations, nfactors=2, rotate=<span style="color: #2d9574;">"none"</span>, fm=<span style="color: #2d9574;">"pa"</span>)
fa
</pre>
</div>

<pre class="example">

Factor Analysis using method =  pa
Call: fa(r = correlations, nfactors = 2, rotate = "none", fm = "pa")
Standardized loadings (pattern matrix) based upon correlation matrix
         PA1   PA2   h2    u2 com
general 0.75  0.07 0.57 0.432 1.0
picture 0.52  0.32 0.38 0.623 1.7
blocks  0.75  0.52 0.83 0.166 1.8
maze    0.39  0.22 0.20 0.798 1.6
reading 0.81 -0.51 0.91 0.089 1.7
vocab   0.73 -0.39 0.69 0.313 1.5

                       PA1  PA2
SS loadings           2.75 0.83
Proportion Var        0.46 0.14
Cumulative Var        0.46 0.60
Proportion Explained  0.77 0.23
Cumulative Proportion 0.77 1.00

Mean item complexity =  1.5
Test of the hypothesis that 2 factors are sufficient.

The degrees of freedom for the null model are  15  and the objective function was  2.48
The degrees of freedom for the model are 4  and the objective function was  0.07 

The root mean square of the residuals (RMSR) is  0.03 
The df corrected root mean square of the residuals is  0.06 

Fit based upon off diagonal values = 0.99
Measures of factor score adequacy             
                                                   PA1  PA2
Correlation of (regression) scores with factors   0.96 0.92
Multiple R square of scores with factors          0.93 0.84
Minimum correlation of possible factor scores     0.86 0.68
</pre>

<p>
???
最大似然法是最常用的方法，但是有时最大似然法不收敛，本例为说明旋转过程，采用主轴迭代法。
</p>

<ul class="org-ul">
<li>解释因子载荷矩阵（结果中的第一个矩阵）的统计特征</li>

<li>PA1、PA2列为因子载荷，是第i个变量与第j个公共因子的相关系数 \(a_{ij}\) 。</li>

<li>h2列为变量 $X<sub>i</sub>$的共同度，是因子载荷矩阵的第i行因子载荷的平方和。记为 $h<sub>i</sub><sup>2</sup>=&sum;<sub>i=1</sub><sup>ma</sup><sub>ij</sub><sup>2</sup> $，所有的公共因子和特殊因子对变量 \(X_i\) 的贡献为1。如果共同度非常靠近1，则说明因子分析的效果好，从原变量空间到公共因子空间的转化性质好。</li>
</ul>
<ul class="org-ul">
<li>SS loadings为因子载荷矩阵中各列元素的平方和 \(S_j=\sum_{i=1}^pa_{ij}^2\) ，因子 \(F_j\) 对所有的 \(X_i\) 的方差贡献和。衡量 \(F_j\) 的相对重要性。</li>

<li>两个因子解释了6个测验60%的方差，但是因子载荷不好解释，需要进行因子旋转</li>
</ul>
<ol class="org-ol">
<li>因子旋转：正交旋转"varimax"  
<ul class="org-ul">
<li>旋转后，阅读和词汇在第一个因子上的载荷比较大，而画图和积木在第二个因子上的载荷比较大，说明存在一个语言智力因子和图像智力因子</li>
</ul></li>
</ol>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#27491;&#20132;&#26059;&#36716;</span>
fa.varimax <span style="color: #ce537a; font-weight: bold;">&lt;-</span> fa(correlations, nfactors=2, rotate=<span style="color: #2d9574;">"varimax"</span>, fm=<span style="color: #2d9574;">"pa"</span>)
fa.varimax
</pre>
</div>

<pre class="example">

Factor Analysis using method =  pa
Call: fa(r = correlations, nfactors = 2, rotate = "varimax", fm = "pa")
Standardized loadings (pattern matrix) based upon correlation matrix
         PA1  PA2   h2    u2 com
general 0.49 0.57 0.57 0.432 2.0
picture 0.16 0.59 0.38 0.623 1.1
blocks  0.18 0.89 0.83 0.166 1.1
maze    0.13 0.43 0.20 0.798 1.2
reading 0.93 0.20 0.91 0.089 1.1
vocab   0.80 0.23 0.69 0.313 1.2

                       PA1  PA2
SS loadings           1.83 1.75
Proportion Var        0.30 0.29
Cumulative Var        0.30 0.60
Proportion Explained  0.51 0.49
Cumulative Proportion 0.51 1.00

Mean item complexity =  1.3
Test of the hypothesis that 2 factors are sufficient.

The degrees of freedom for the null model are  15  and the objective function was  2.48
The degrees of freedom for the model are 4  and the objective function was  0.07 

The root mean square of the residuals (RMSR) is  0.03 
The df corrected root mean square of the residuals is  0.06 

Fit based upon off diagonal values = 0.99
Measures of factor score adequacy             
                                                   PA1  PA2
Correlation of (regression) scores with factors   0.96 0.92
Multiple R square of scores with factors          0.91 0.85
Minimum correlation of possible factor scores     0.82 0.71
</pre>

<ul class="org-ul">
<li>正交旋转后，每个变量的共同度（h2）不变，两个因子的载荷分配发生了变化（SS loadings和Proportion Var），但是它们的总方差贡献（Cumulative Var）仍为60%</li>
</ul>
<ol class="org-ol">
<li>因子旋转：斜交旋转"promax"</li>
</ol>
<div class="org-src-container">
<pre class="src src-R">fa.promax <span style="color: #ce537a; font-weight: bold;">&lt;-</span> fa(correlations, nfactors=2, rotate=<span style="color: #2d9574;">"promax"</span>, fm=<span style="color: #2d9574;">"pa"</span>)
fa.promax
</pre>
</div>

<pre class="example">

Factor Analysis using method =  pa
Call: fa(r = correlations, nfactors = 2, rotate = "promax", fm = "pa")
Standardized loadings (pattern matrix) based upon correlation matrix
          PA1   PA2   h2    u2 com
general  0.37  0.48 0.57 0.432 1.9
picture -0.03  0.63 0.38 0.623 1.0
blocks  -0.10  0.97 0.83 0.166 1.0
maze     0.00  0.45 0.20 0.798 1.0
reading  1.00 -0.09 0.91 0.089 1.0
vocab    0.84 -0.01 0.69 0.313 1.0

                       PA1  PA2
SS loadings           1.83 1.75
Proportion Var        0.30 0.29
Cumulative Var        0.30 0.60
Proportion Explained  0.51 0.49
Cumulative Proportion 0.51 1.00

 With factor correlations of 
     PA1  PA2
PA1 1.00 0.55
PA2 0.55 1.00

Mean item complexity =  1.2
Test of the hypothesis that 2 factors are sufficient.

The degrees of freedom for the null model are  15  and the objective function was  2.48
The degrees of freedom for the model are 4  and the objective function was  0.07 

The root mean square of the residuals (RMSR) is  0.03 
The df corrected root mean square of the residuals is  0.06 

Fit based upon off diagonal values = 0.99
Measures of factor score adequacy             
                                                   PA1  PA2
Correlation of (regression) scores with factors   0.97 0.94
Multiple R square of scores with factors          0.93 0.88
Minimum correlation of possible factor scores     0.86 0.77
</pre>

<ul class="org-ul">
<li>斜交旋转后，因子载荷矩阵中的载荷不再是变量和因子的相关系数，而是因子对变量进行回归后的标准化回归系数，所以载荷有可能会大于1或小于-1</li>
<li>与正交旋转相同，每个变量的共同度（h2）不变，两个因子的载荷分配发生变化，但累计方差贡献率（Cumulative Var）不变，仍为60%</li>
<li>此时，两个因子不再正交独立，相关系数为0.55（因子相关矩阵）</li>

<li>两因子载荷图：展示各原始变量在各因子上的载荷</li>
</ul>
<div class="org-src-container">
<pre class="src src-R">factor.plot(fa.promax, labels=rownames(fa.promax$loadings))
</pre>
</div>


<div class="figure">
<p><img src="6.png" alt="6.png" />
</p>
</div>

<ul class="org-ul">
<li>因子载荷结构图：展示潜在因子与变量之间的结构</li>
</ul>

<div class="org-src-container">
<pre class="src src-R">fa.diagram(fa.promax, simple=<span style="color: #a45bad;">FALSE</span>)
</pre>
</div>


<div class="figure">
<p><img src="7.png" alt="7.png" />
</p>
</div>

<ol class="org-ol">
<li>因子得分系数</li>
</ol>

<p>
\[PA1=0.078\times general+0.020\times picture+0.037\times blocks+\cdots +0.177\times vocab\]
</p>

<p>
\[PA2=0.211\times general+0.090\times picture+0.702\times blocks+\cdots +0.036\times vocab\]
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#22240;&#23376;&#24471;&#20998;</span>
fa.promax$scores
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#22240;&#23376;&#24471;&#20998;&#31995;&#25968;</span>
fa.promax$weights

</pre>
</div>

<pre class="example">

NULL

               PA1        PA2
general 0.07836571 0.21091463
picture 0.02000694 0.09038071
blocks  0.03662858 0.70209400
maze    0.02700266 0.03453381
reading 0.74276722 0.03012597
vocab   0.17683183 0.03583324
</pre>
</div>
</div>

<div id="outline-container-org2df0b4d" class="outline-3">
<h3 id="org2df0b4d"><span class="section-number-3">6.5</span> 因子分析的前提条件</h3>
<div class="outline-text-3" id="text-6-5">
<ul class="org-ul">
<li>样本量没有通用的要求，一般50以下太少，100较少，200基本足够，300较好，500非常好，超过1000特别合适。</li>
<li>KMO样本测度检验数据中是否存在显著的因子。KMO在0.9以上，非常适合；0.8-0.9很适合；0.7-0.8适合；0.6-0.7不太适合；0.5-0.6很勉强；0.5以下，不适合；因子分析前应该剔除掉KMO小于0.5的原始变量。</li>
<li>巴特莱特球体检验：原假设H0为相关系数矩阵R为单位阵I，即原始变量两两独立。如果拒绝原假设才可作因子分析</li>
</ul>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">KMO &#26679;&#26412;&#27979;&#24230;</span>
KMO(USJudgeRatings[,-1])
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#24052;&#29305;&#33713;&#29305;&#29699;&#20307;&#26816;&#39564;</span>
cortest.bartlett(correlations,n=112)

</pre>
</div>

<pre class="example">

Kaiser-Meyer-Olkin factor adequacy
Call: KMO(r = USJudgeRatings[, -1])
Overall MSA =  0.91
MSA for each item = 
INTG DMNR DILG CFMG DECI PREP FAMI ORAL WRIT PHYS RTEN 
0.88 0.92 0.92 0.91 0.91 0.90 0.88 0.93 0.91 0.90 0.90

$chisq
[1] 268.3538

$p.value
[1] 2.027158e-48

$df
[1] 15
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: 厦门大学公共事务学院</p>
<p class="date">Created: 2021-12-09 四 11:33</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
